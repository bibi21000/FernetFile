<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 15.0.1"/>
    <title>fernetfile.store API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../fernetfile.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;fernetfile</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#TarZstdFernetFile">TarZstdFernetFile</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#TarZstdFernetFile.__init__">TarZstdFernetFile</a>
                        </li>
                        <li>
                                <a class="variable" href="#TarZstdFernetFile.fernet_file">fernet_file</a>
                        </li>
                        <li>
                                <a class="function" href="#TarZstdFernetFile.close">close</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#StoreInfo">StoreInfo</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#StoreInfo.__init__">StoreInfo</a>
                        </li>
                        <li>
                                <a class="variable" href="#StoreInfo.store_path">store_path</a>
                        </li>
                        <li>
                                <a class="variable" href="#StoreInfo.path">path</a>
                        </li>
                        <li>
                                <a class="variable" href="#StoreInfo.mtime">mtime</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#FernetStore">FernetStore</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#FernetStore.__init__">FernetStore</a>
                        </li>
                        <li>
                                <a class="variable" href="#FernetStore.filename">filename</a>
                        </li>
                        <li>
                                <a class="variable" href="#FernetStore.fernet_key">fernet_key</a>
                        </li>
                        <li>
                                <a class="variable" href="#FernetStore.kwargs">kwargs</a>
                        </li>
                        <li>
                                <a class="variable" href="#FernetStore.backup">backup</a>
                        </li>
                        <li>
                                <a class="variable" href="#FernetStore.auto_flush">auto_flush</a>
                        </li>
                        <li>
                                <a class="variable" href="#FernetStore.secure_open">secure_open</a>
                        </li>
                        <li>
                                <a class="variable" href="#FernetStore.secure_params">secure_params</a>
                        </li>
                        <li>
                                <a class="variable" href="#FernetStore.dirpath">dirpath</a>
                        </li>
                        <li>
                                <a class="function" href="#FernetStore.open">open</a>
                        </li>
                        <li>
                                <a class="function" href="#FernetStore.getmembers">getmembers</a>
                        </li>
                        <li>
                                <a class="function" href="#FernetStore.close">close</a>
                        </li>
                        <li>
                                <a class="function" href="#FernetStore.flush">flush</a>
                        </li>
                        <li>
                                <a class="function" href="#FernetStore.file">file</a>
                        </li>
                        <li>
                                <a class="function" href="#FernetStore.add">add</a>
                        </li>
                        <li>
                                <a class="function" href="#FernetStore.extractall">extractall</a>
                        </li>
                        <li>
                                <a class="function" href="#FernetStore.delete">delete</a>
                        </li>
                        <li>
                                <a class="function" href="#FernetStore.append">append</a>
                        </li>
                        <li>
                                <a class="function" href="#FernetStore.write">write</a>
                        </li>
                        <li>
                                <a class="function" href="#FernetStore.read">read</a>
                        </li>
                        <li>
                                <a class="function" href="#FernetStore.readlines">readlines</a>
                        </li>
                        <li>
                                <a class="function" href="#FernetStore.writelines">writelines</a>
                        </li>
                        <li>
                                <a class="variable" href="#FernetStore.mtime">mtime</a>
                        </li>
                        <li>
                                <a class="variable" href="#FernetStore.modified">modified</a>
                        </li>
                        <li>
                                <a class="variable" href="#FernetStore.closed">closed</a>
                        </li>
                        <li>
                                <a class="variable" href="#FernetStore.readable">readable</a>
                        </li>
                        <li>
                                <a class="variable" href="#FernetStore.writable">writable</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#open">open</a>
            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../fernetfile.html">fernetfile</a><wbr>.store    </h1>

                        <div class="docstring"><p>Store your files in a ztsd/tar based archive.</p>

<p>Interface "compatible" with tar</p>
</div>

                        <input id="mod-store-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-store-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="c1"># -*- encoding: utf-8 -*-</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="sd">&quot;&quot;&quot; Store your files in a ztsd/tar based archive.</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="sd">Interface &quot;compatible&quot; with tar</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a><span class="n">__license__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="s2">    All rights reserved by Labo-Online</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a><span class="s2">&quot;&quot;&quot;</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a><span class="n">__copyright__</span> <span class="o">=</span> <span class="s2">&quot;Copyright ©2024-2025 &quot;</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="n">__author__</span> <span class="o">=</span> <span class="s1">&#39;bibi21000 aka Sébastien GALLET&#39;</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a><span class="n">__email__</span> <span class="o">=</span> <span class="s1">&#39;bibi21000@gmail.com&#39;</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">tempfile</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">threading</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">contextlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">contextmanager</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">shutil</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">tarfile</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">io</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">filelock</span><span class="w"> </span><span class="kn">import</span> <span class="n">FileLock</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">fernetfile.zstd</span><span class="w"> </span><span class="kn">import</span> <span class="n">FernetFile</span> <span class="k">as</span> <span class="n">ZstdFernetFile</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">fernetfile.zstd</span><span class="w"> </span><span class="kn">import</span> <span class="n">CHUNK_SIZE</span><span class="p">,</span> <span class="n">READ</span><span class="p">,</span> <span class="n">WRITE</span><span class="p">,</span> <span class="n">APPEND</span><span class="p">,</span> <span class="n">EXCLUSIVE</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a><span class="n">_open</span> <span class="o">=</span> <span class="nb">open</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a><span class="k">class</span><span class="w"> </span><span class="nc">TarZstdFernetFile</span><span class="p">(</span><span class="n">tarfile</span><span class="o">.</span><span class="n">TarFile</span><span class="p">):</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The container of the store. Based on TarFfile with encryption&quot;&quot;&quot;</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">fileobj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fernet_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Init the TarZstdFernetFile&quot;&quot;&quot;</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a>        <span class="n">level_or_option</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;level_or_option&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a>        <span class="n">zstd_dict</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;zstd_dict&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a>        <span class="n">chunk_size</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;chunk_size&#39;</span><span class="p">,</span> <span class="n">CHUNK_SIZE</span><span class="p">)</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fernet_file</span> <span class="o">=</span> <span class="n">ZstdFernetFile</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">fileobj</span><span class="o">=</span><span class="n">fileobj</span><span class="p">,</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a>            <span class="n">fernet_key</span><span class="o">=</span><span class="n">fernet_key</span><span class="p">,</span> <span class="n">level_or_option</span><span class="o">=</span><span class="n">level_or_option</span><span class="p">,</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a>                <span class="n">zstd_dict</span><span class="o">=</span><span class="n">zstd_dict</span><span class="p">,</span> <span class="n">chunk_size</span><span class="o">=</span><span class="n">chunk_size</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a>            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">fileobj</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fernet_file</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">fernet_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a>            <span class="k">raise</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Close the TarZstdFernetFile&quot;&quot;&quot;</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a>            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a>        <span class="k">finally</span><span class="p">:</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fernet_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">fernet_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; &quot;&quot;&quot;</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a>        <span class="n">s</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fernet_file</span><span class="p">)</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a>        <span class="k">return</span> <span class="s1">&#39;&lt;TarZstdFernet &#39;</span> <span class="o">+</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">hex</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;&gt;&#39;</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a><span class="k">class</span><span class="w"> </span><span class="nc">StoreInfo</span><span class="p">():</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot; &quot;&quot;&quot;</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">store_path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;A representation of the file in tmp&quot;&quot;&quot;</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">store_path</span> <span class="o">=</span> <span class="n">store_path</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a>        <span class="n">sname</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a>        <span class="k">if</span> <span class="n">sname</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">sname</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">sname</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a>        <span class="n">dirs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dirs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="p">:</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">subdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store_path</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">dirs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dirpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">subdir</span><span class="p">)</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">subdir</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dirpath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">store_path</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store_path</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a>    <span class="nd">@property</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">mtime</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The mtime of the file in tmp&quot;&quot;&quot;</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">):</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a>            <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; &quot;&quot;&quot;</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a>        <span class="n">s</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a>        <span class="k">return</span> <span class="s1">&#39;&lt;FernetStoreInfo &#39;</span> <span class="o">+</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">hex</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;&gt;&#39;</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a><span class="k">class</span><span class="w"> </span><span class="nc">FernetStore</span><span class="p">():</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot; &quot;&quot;&quot;</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a>    <span class="n">filename</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fernet_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fileobj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a>            <span class="n">secure_open</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">secure_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">auto_flush</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a>            <span class="n">backup</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Constructor for the FernetFile class.</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a><span class="sd">        At least one of fileobj and filename must be given a</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a><span class="sd">        non-trivial value.</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a><span class="sd">        The new class instance is based on fileobj, which can be a regular</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a><span class="sd">        file, an io.BytesIO object, or any other object which simulates a file.</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a><span class="sd">        It defaults to None, in which case filename is opened to provide</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a><span class="sd">        a file object.</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a><span class="sd">        When fileobj is not None, the filename argument is only used to be</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a><span class="sd">        included in the gzip file header, which may include the original</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a><span class="sd">        filename of the uncompressed file.  It defaults to the filename of</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a><span class="sd">        fileobj, if discernible; otherwise, it defaults to the empty string,</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a><span class="sd">        and in this case the original filename is not included in the header.</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a><span class="sd">        The mode argument can be any of &#39;r&#39;, &#39;rb&#39;, &#39;a&#39;, &#39;ab&#39;, &#39;w&#39;, &#39;wb&#39;, &#39;x&#39;, or</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a><span class="sd">        &#39;xb&#39; depending on whether the file will be read or written.  The default</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a><span class="sd">        is the mode of fileobj if discernible; otherwise, the default is &#39;rb&#39;.</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a><span class="sd">        A mode of &#39;r&#39; is equivalent to one of &#39;rb&#39;, and similarly for &#39;w&#39; and</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a><span class="sd">        &#39;wb&#39;, &#39;a&#39; and &#39;ab&#39;, and &#39;x&#39; and &#39;xb&#39;.</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a><span class="sd">        The fernet_key argument is the Fernet key used to crypt/decrypt data.</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a><span class="sd">        Encryption is done by chunks to reduce memory footprint. The default</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a><span class="sd">        chunk_size is 64KB.</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a><span class="sd">        Files are stored in clear mode when opening archive (in a directory in /tmp).</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a><span class="sd">        You can give a &quot;secured open&quot; command to avoid that (in dev)</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a><span class="sd">        Everytime data are written in archive, it is flushed to file : this means</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a><span class="sd">        that thar archive is compressed and crypted. You can change this with auto_flush.</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a><span class="sd">        Data will be flushed only on close.</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a><span class="sd">        This store is thread safe, this allows you to flush from a timer for example.</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a><span class="sd">        If you want to backup archive before flushing it, pass extention to this parameter.</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a>        <span class="k">if</span> <span class="n">fernet_key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid fernet key: </span><span class="si">{!r}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fernet_key</span><span class="p">))</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a>        <span class="k">if</span> <span class="n">mode</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;t&#39;</span> <span class="ow">in</span> <span class="n">mode</span> <span class="ow">or</span> <span class="s1">&#39;U&#39;</span> <span class="ow">in</span> <span class="n">mode</span><span class="p">):</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid mode: </span><span class="si">{!r}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mode</span><span class="p">))</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a>        <span class="k">if</span> <span class="n">mode</span> <span class="ow">and</span> <span class="s1">&#39;b&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">mode</span><span class="p">:</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a>            <span class="n">mode</span> <span class="o">+=</span> <span class="s1">&#39;b&#39;</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a>        <span class="k">if</span> <span class="n">mode</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">):</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">READ</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a>        <span class="k">elif</span> <span class="n">mode</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">):</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">WRITE</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a>        <span class="k">elif</span> <span class="n">mode</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">):</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">APPEND</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a>        <span class="k">elif</span> <span class="n">mode</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">):</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">EXCLUSIVE</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid mode: </span><span class="si">{!r}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mode</span><span class="p">))</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fernet_key</span> <span class="o">=</span> <span class="n">fernet_key</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a>        <span class="k">if</span> <span class="n">fileobj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">fileobj</span><span class="o">.</span><span class="n">name</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">fileobj</span> <span class="o">=</span> <span class="n">fileobj</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">fileobj</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid filename: </span><span class="si">{!r}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">backup</span> <span class="o">=</span> <span class="n">backup</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">auto_flush</span> <span class="o">=</span> <span class="n">auto_flush</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_lockfile</span> <span class="o">=</span> <span class="n">FileLock</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">+</span><span class="s1">&#39;.lock&#39;</span><span class="p">)</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">secure_open</span> <span class="o">=</span> <span class="n">_open</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">secure_params</span> <span class="o">=</span> <span class="n">secure_params</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a>        <span class="k">if</span> <span class="n">secure_open</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">secure_open</span> <span class="o">=</span> <span class="n">secure_open</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">secure_params</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">secure_params</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dirpath</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirctime</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirmtime</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;A repr of the store&quot;&quot;&quot;</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a>        <span class="n">s</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a>        <span class="k">return</span> <span class="s1">&#39;&lt;FernetStore &#39;</span> <span class="o">+</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">hex</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;&gt;&#39;</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_check_not_closed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if the store is closed&quot;&quot;&quot;</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">closed</span><span class="p">:</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a>            <span class="k">raise</span> <span class="n">io</span><span class="o">.</span><span class="n">UnsupportedOperation</span><span class="p">(</span><span class="s2">&quot;I/O operation on closed file&quot;</span><span class="p">)</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_check_can_write</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check we can write in store&quot;&quot;&quot;</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">closed</span><span class="p">:</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a>            <span class="k">raise</span> <span class="n">io</span><span class="o">.</span><span class="n">UnsupportedOperation</span><span class="p">(</span><span class="s2">&quot;I/O operation on closed file&quot;</span><span class="p">)</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">writable</span><span class="p">:</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a>            <span class="k">raise</span> <span class="n">io</span><span class="o">.</span><span class="n">UnsupportedOperation</span><span class="p">(</span><span class="s2">&quot;File not open for writing&quot;</span><span class="p">)</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_check_can_read</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check we can read in store&quot;&quot;&quot;</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">closed</span><span class="p">:</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a>            <span class="k">raise</span> <span class="n">io</span><span class="o">.</span><span class="n">UnsupportedOperation</span><span class="p">(</span><span class="s2">&quot;I/O operation on closed file&quot;</span><span class="p">)</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">readable</span><span class="p">:</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a>            <span class="k">raise</span> <span class="n">io</span><span class="o">.</span><span class="n">UnsupportedOperation</span><span class="p">(</span><span class="s2">&quot;File not open for reading&quot;</span><span class="p">)</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Enter context manager&quot;&quot;&quot;</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">):</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Exit context manager&quot;&quot;&quot;</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Open the store with a lock&quot;&quot;&quot;</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_lockfile</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a>        <span class="n">file_exists</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a>        <span class="k">if</span> <span class="n">file_exists</span><span class="p">:</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">EXCLUSIVE</span><span class="p">:</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a>                <span class="k">raise</span> <span class="ne">FileExistsError</span><span class="p">(</span><span class="s1">&#39;File already exists </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">READ</span><span class="p">:</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a>                <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s1">&#39;File not found </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dirpath</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;.fernet_&quot;</span><span class="p">)</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a>        <span class="k">if</span> <span class="n">file_exists</span><span class="p">:</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a>            <span class="k">with</span> <span class="n">TarZstdFernetFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;rb&#39;</span><span class="p">,</span> <span class="n">fileobj</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fileobj</span><span class="p">,</span> <span class="n">fernet_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fernet_key</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">as</span> <span class="n">tff</span><span class="p">:</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a>                <span class="n">tff</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dirpath</span><span class="p">)</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirctime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dirmtime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time_ns</span><span class="p">()</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_write_store</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Write the store in filename&quot;&quot;&quot;</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_can_write</span><span class="p">()</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">backup</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a>                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">backup</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">backup</span><span class="p">)</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a>                <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">backup</span><span class="p">)</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a>            <span class="k">with</span> <span class="n">TarZstdFernetFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;wb&#39;</span><span class="p">,</span> <span class="n">fileobj</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fileobj</span><span class="p">,</span> <span class="n">fernet_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fernet_key</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">as</span> <span class="n">tff</span><span class="p">:</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a>                <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getmembers</span><span class="p">():</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a>                    <span class="n">tff</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">member</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">arcname</span><span class="o">=</span><span class="n">member</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_dirctime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dirmtime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time_ns</span><span class="p">()</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">getmembers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get members or the store&quot;&quot;&quot;</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a>        <span class="n">members</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a>        <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dirpath</span><span class="p">):</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a>            <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a>                <span class="n">aname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="n">root</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dirpath</span><span class="p">):],</span> <span class="n">fname</span> <span class="p">)</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a>                <span class="n">members</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">StoreInfo</span><span class="p">(</span><span class="n">aname</span><span class="p">,</span> <span class="n">store_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dirpath</span><span class="p">))</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a>        <span class="k">return</span> <span class="n">members</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Close the store. If file is open for writing, the store is rewriting&quot;&quot;&quot;</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">writable</span><span class="p">:</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_write_store</span><span class="p">()</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a>        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dirpath</span><span class="p">)</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dirpath</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirctime</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirmtime</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_lockfile</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">flush</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Flush data to store if needed. Unless force is True &quot;&quot;&quot;</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a>        <span class="k">if</span> <span class="n">force</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">modified</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a>            <span class="k">return</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_write_store</span><span class="p">()</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a>    <span class="nd">@contextmanager</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arcname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;rb&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a file descriptor on arcname&quot;&quot;&quot;</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a>        <span class="n">fffile</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arcname</span><span class="p">,</span> <span class="n">StoreInfo</span><span class="p">):</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a>                <span class="n">finfo</span> <span class="o">=</span> <span class="n">arcname</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a>                <span class="n">finfo</span> <span class="o">=</span> <span class="n">StoreInfo</span><span class="p">(</span><span class="n">arcname</span><span class="p">,</span> <span class="n">store_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dirpath</span><span class="p">)</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a>                <span class="k">if</span> <span class="n">finfo</span><span class="o">.</span><span class="n">subdir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dirpath</span><span class="p">,</span> <span class="n">finfo</span><span class="o">.</span><span class="n">subdir</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a>                <span class="n">fffile</span> <span class="o">=</span> <span class="n">ffile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">secure_open</span><span class="p">(</span><span class="n">finfo</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">secure_params</span><span class="p">)</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a>                <span class="k">yield</span> <span class="n">ffile</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a>                <span class="n">ffile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a>                <span class="n">ffile</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a>                <span class="k">if</span> <span class="n">mode</span><span class="o">.</span><span class="n">startswith</span><span class="p">((</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">)):</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_dirmtime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time_ns</span><span class="p">()</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a>            <span class="k">finally</span><span class="p">:</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a>                <span class="k">if</span> <span class="n">fffile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a>                    <span class="n">fffile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a>                    <span class="n">fffile</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_flush</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">mode</span><span class="o">.</span><span class="n">startswith</span><span class="p">((</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">)):</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">arcname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Add file as arcname. If arcname exists, it is replaced by default.</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a><span class="sd">        Otherwise an exception is raised&quot;&quot;&quot;</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_check_can_write</span><span class="p">()</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arcname</span><span class="p">,</span> <span class="n">StoreInfo</span><span class="p">):</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a>                <span class="n">finfo</span> <span class="o">=</span> <span class="n">arcname</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a>                <span class="n">finfo</span> <span class="o">=</span> <span class="n">StoreInfo</span><span class="p">(</span><span class="n">arcname</span><span class="p">,</span> <span class="n">store_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dirpath</span><span class="p">)</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a>            <span class="n">file_exists</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">finfo</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a>            <span class="k">if</span> <span class="n">file_exists</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">replace</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a>                <span class="k">raise</span> <span class="ne">FileExistsError</span><span class="p">(</span><span class="s1">&#39;File already exists </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a>            <span class="k">if</span> <span class="n">file_exists</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_delete</span><span class="p">(</span><span class="n">arcinfo</span><span class="o">=</span><span class="n">finfo</span><span class="p">)</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a>            <span class="k">if</span> <span class="n">finfo</span><span class="o">.</span><span class="n">subdir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dirpath</span><span class="p">,</span> <span class="n">finfo</span><span class="o">.</span><span class="n">subdir</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a>            <span class="k">with</span> <span class="n">_open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ff</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">secure_open</span><span class="p">(</span><span class="n">finfo</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;wb&#39;</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">secure_params</span><span class="p">)</span> <span class="k">as</span> <span class="n">sf</span><span class="p">:</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a>                <span class="n">sf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ff</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_dirmtime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time_ns</span><span class="p">()</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_flush</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">extractall</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">members</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract all files to path&quot;&quot;&quot;</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_check_can_read</span><span class="p">()</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a>            <span class="k">if</span> <span class="n">members</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a>                <span class="n">members</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getmembers</span><span class="p">()</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a>            <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="n">members</span><span class="p">:</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a>                <span class="k">if</span> <span class="n">member</span><span class="o">.</span><span class="n">subdir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">member</span><span class="o">.</span><span class="n">subdir</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a>                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">secure_open</span><span class="p">(</span><span class="n">member</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;rb&#39;</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">secure_params</span><span class="p">)</span> <span class="k">as</span> <span class="n">fin</span><span class="p">,</span> \
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a>                    <span class="n">_open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">member</span><span class="o">.</span><span class="n">name</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fout</span><span class="p">:</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a>                        <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">fin</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arcinfo</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete file in store without lock&quot;&quot;&quot;</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_can_write</span><span class="p">()</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">arcinfo</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirmtime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time_ns</span><span class="p">()</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arcname</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete file in store&quot;&quot;&quot;</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arcname</span><span class="p">,</span> <span class="n">StoreInfo</span><span class="p">):</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a>                <span class="n">finfo</span> <span class="o">=</span> <span class="n">arcname</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a>                <span class="n">finfo</span> <span class="o">=</span> <span class="n">StoreInfo</span><span class="p">(</span><span class="n">arcname</span><span class="p">,</span> <span class="n">store_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dirpath</span><span class="p">)</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_delete</span><span class="p">(</span><span class="n">arcinfo</span><span class="o">=</span><span class="n">finfo</span><span class="p">)</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_flush</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">arcname</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Append data to arcname&quot;&quot;&quot;</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_can_write</span><span class="p">()</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="p">(</span><span class="n">arcname</span><span class="o">=</span><span class="n">arcname</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;ab&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">nf</span><span class="p">:</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a>            <span class="n">nf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">arcname</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Write data to arcname&quot;&quot;&quot;</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_can_write</span><span class="p">()</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="p">(</span><span class="n">arcname</span><span class="o">=</span><span class="n">arcname</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">nf</span><span class="p">:</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a>            <span class="n">nf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arcname</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Read data from arcname&quot;&quot;&quot;</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_not_closed</span><span class="p">()</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="p">(</span><span class="n">arcname</span><span class="o">=</span><span class="n">arcname</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">nf</span><span class="p">:</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a>            <span class="k">return</span> <span class="n">nf</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">readlines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arcname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;UTF-8&#39;</span><span class="p">):</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Read a list of lines from arcname&quot;&quot;&quot;</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_not_closed</span><span class="p">()</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a>        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="p">(</span><span class="n">arcname</span><span class="o">=</span><span class="n">arcname</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;rt&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span> <span class="k">as</span> <span class="n">nf</span><span class="p">:</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a>            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">nf</span><span class="p">:</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a>                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">())</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a>        <span class="k">return</span> <span class="n">lines</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a>
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">writelines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lines</span><span class="p">,</span> <span class="n">arcname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;UTF-8&#39;</span><span class="p">):</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Write a list of lines to arcname&quot;&quot;&quot;</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_can_write</span><span class="p">()</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="p">(</span><span class="n">arcname</span><span class="o">=</span><span class="n">arcname</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;wt&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span> <span class="k">as</span> <span class="n">nf</span><span class="p">:</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a>            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a>                <span class="n">nf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a>
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a>    <span class="nd">@property</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">mtime</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Last modification time read from stream, or None.&quot;&quot;&quot;</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a>            <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a>
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a>    <span class="nd">@property</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">modified</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Archive has been updated but not flushed.&quot;&quot;&quot;</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_not_closed</span><span class="p">()</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dirctime</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dirmtime</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a>
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a>    <span class="nd">@property</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">closed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;True if this file is closed.&quot;&quot;&quot;</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dirpath</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a>
</span><span id="L-407"><a href="#L-407"><span class="linenos">407</span></a>    <span class="nd">@property</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos">408</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">readable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos">409</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return whether the file was opened for reading.&quot;&quot;&quot;</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos">410</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_not_closed</span><span class="p">()</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos">411</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">READ</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos">412</span></a>
</span><span id="L-413"><a href="#L-413"><span class="linenos">413</span></a>    <span class="nd">@property</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos">414</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">writable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos">415</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return whether the file was opened for writing.&quot;&quot;&quot;</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos">416</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_not_closed</span><span class="p">()</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos">417</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">WRITE</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">APPEND</span> \
</span><span id="L-418"><a href="#L-418"><span class="linenos">418</span></a>            <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">EXCLUSIVE</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos">419</span></a>
</span><span id="L-420"><a href="#L-420"><span class="linenos">420</span></a>
</span><span id="L-421"><a href="#L-421"><span class="linenos">421</span></a><span class="k">def</span><span class="w"> </span><span class="nf">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;rb&quot;</span><span class="p">,</span> <span class="n">fernet_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos">422</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Open a FernetStore file in binary mode.</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos">423</span></a>
</span><span id="L-424"><a href="#L-424"><span class="linenos">424</span></a><span class="sd">    The filename argument can be an actual filename (a str or bytes object), or</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos">425</span></a><span class="sd">    an existing file object to read from or write to.</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos">426</span></a>
</span><span id="L-427"><a href="#L-427"><span class="linenos">427</span></a><span class="sd">    The mode argument can be &quot;r&quot;, &quot;rb&quot;, &quot;w&quot;, &quot;wb&quot;, &quot;x&quot;, &quot;xb&quot;, &quot;a&quot; or &quot;ab&quot; for</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos">428</span></a><span class="sd">    binary mode.</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos">429</span></a>
</span><span id="L-430"><a href="#L-430"><span class="linenos">430</span></a><span class="sd">    For binary mode, this function is equivalent to the FernetFile constructor:</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos">431</span></a><span class="sd">    FernetFile(filename, mode, fernet_key). In this case, the encoding, errors</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos">432</span></a><span class="sd">    and newline arguments must not be provided.</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos">433</span></a>
</span><span id="L-434"><a href="#L-434"><span class="linenos">434</span></a>
</span><span id="L-435"><a href="#L-435"><span class="linenos">435</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos">436</span></a>    <span class="k">if</span> <span class="s2">&quot;t&quot;</span> <span class="ow">in</span> <span class="n">mode</span><span class="p">:</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos">437</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid mode: </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mode</span><span class="p">,))</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos">438</span></a>
</span><span id="L-439"><a href="#L-439"><span class="linenos">439</span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">)):</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos">440</span></a>        <span class="n">binary_file</span> <span class="o">=</span> <span class="n">FernetStore</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">fernet_key</span><span class="o">=</span><span class="n">fernet_key</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos">441</span></a>    <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;read&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;write&quot;</span><span class="p">):</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos">442</span></a>        <span class="n">binary_file</span> <span class="o">=</span> <span class="n">FernetStore</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">fileobj</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="n">fernet_key</span><span class="o">=</span><span class="n">fernet_key</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos">443</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos">444</span></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;filename must be a str or bytes object, or a file&quot;</span><span class="p">)</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos">445</span></a>
</span><span id="L-446"><a href="#L-446"><span class="linenos">446</span></a>    <span class="k">return</span> <span class="n">binary_file</span>
</span></pre></div>


            </section>
                <section id="TarZstdFernetFile">
                            <input id="TarZstdFernetFile-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">TarZstdFernetFile</span><wbr>(<span class="base">tarfile.TarFile</span>):

                <label class="view-source-button" for="TarZstdFernetFile-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TarZstdFernetFile"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TarZstdFernetFile-32"><a href="#TarZstdFernetFile-32"><span class="linenos">32</span></a><span class="k">class</span><span class="w"> </span><span class="nc">TarZstdFernetFile</span><span class="p">(</span><span class="n">tarfile</span><span class="o">.</span><span class="n">TarFile</span><span class="p">):</span>
</span><span id="TarZstdFernetFile-33"><a href="#TarZstdFernetFile-33"><span class="linenos">33</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The container of the store. Based on TarFfile with encryption&quot;&quot;&quot;</span>
</span><span id="TarZstdFernetFile-34"><a href="#TarZstdFernetFile-34"><span class="linenos">34</span></a>
</span><span id="TarZstdFernetFile-35"><a href="#TarZstdFernetFile-35"><span class="linenos">35</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">fileobj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fernet_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="TarZstdFernetFile-36"><a href="#TarZstdFernetFile-36"><span class="linenos">36</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Init the TarZstdFernetFile&quot;&quot;&quot;</span>
</span><span id="TarZstdFernetFile-37"><a href="#TarZstdFernetFile-37"><span class="linenos">37</span></a>        <span class="n">level_or_option</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;level_or_option&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="TarZstdFernetFile-38"><a href="#TarZstdFernetFile-38"><span class="linenos">38</span></a>        <span class="n">zstd_dict</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;zstd_dict&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="TarZstdFernetFile-39"><a href="#TarZstdFernetFile-39"><span class="linenos">39</span></a>        <span class="n">chunk_size</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;chunk_size&#39;</span><span class="p">,</span> <span class="n">CHUNK_SIZE</span><span class="p">)</span>
</span><span id="TarZstdFernetFile-40"><a href="#TarZstdFernetFile-40"><span class="linenos">40</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fernet_file</span> <span class="o">=</span> <span class="n">ZstdFernetFile</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">fileobj</span><span class="o">=</span><span class="n">fileobj</span><span class="p">,</span>
</span><span id="TarZstdFernetFile-41"><a href="#TarZstdFernetFile-41"><span class="linenos">41</span></a>            <span class="n">fernet_key</span><span class="o">=</span><span class="n">fernet_key</span><span class="p">,</span> <span class="n">level_or_option</span><span class="o">=</span><span class="n">level_or_option</span><span class="p">,</span>
</span><span id="TarZstdFernetFile-42"><a href="#TarZstdFernetFile-42"><span class="linenos">42</span></a>                <span class="n">zstd_dict</span><span class="o">=</span><span class="n">zstd_dict</span><span class="p">,</span> <span class="n">chunk_size</span><span class="o">=</span><span class="n">chunk_size</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="TarZstdFernetFile-43"><a href="#TarZstdFernetFile-43"><span class="linenos">43</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="TarZstdFernetFile-44"><a href="#TarZstdFernetFile-44"><span class="linenos">44</span></a>            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">fileobj</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fernet_file</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="TarZstdFernetFile-45"><a href="#TarZstdFernetFile-45"><span class="linenos">45</span></a>
</span><span id="TarZstdFernetFile-46"><a href="#TarZstdFernetFile-46"><span class="linenos">46</span></a>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="TarZstdFernetFile-47"><a href="#TarZstdFernetFile-47"><span class="linenos">47</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">fernet_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="TarZstdFernetFile-48"><a href="#TarZstdFernetFile-48"><span class="linenos">48</span></a>            <span class="k">raise</span>
</span><span id="TarZstdFernetFile-49"><a href="#TarZstdFernetFile-49"><span class="linenos">49</span></a>
</span><span id="TarZstdFernetFile-50"><a href="#TarZstdFernetFile-50"><span class="linenos">50</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="TarZstdFernetFile-51"><a href="#TarZstdFernetFile-51"><span class="linenos">51</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Close the TarZstdFernetFile&quot;&quot;&quot;</span>
</span><span id="TarZstdFernetFile-52"><a href="#TarZstdFernetFile-52"><span class="linenos">52</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="TarZstdFernetFile-53"><a href="#TarZstdFernetFile-53"><span class="linenos">53</span></a>            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="TarZstdFernetFile-54"><a href="#TarZstdFernetFile-54"><span class="linenos">54</span></a>
</span><span id="TarZstdFernetFile-55"><a href="#TarZstdFernetFile-55"><span class="linenos">55</span></a>        <span class="k">finally</span><span class="p">:</span>
</span><span id="TarZstdFernetFile-56"><a href="#TarZstdFernetFile-56"><span class="linenos">56</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fernet_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TarZstdFernetFile-57"><a href="#TarZstdFernetFile-57"><span class="linenos">57</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">fernet_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="TarZstdFernetFile-58"><a href="#TarZstdFernetFile-58"><span class="linenos">58</span></a>
</span><span id="TarZstdFernetFile-59"><a href="#TarZstdFernetFile-59"><span class="linenos">59</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="TarZstdFernetFile-60"><a href="#TarZstdFernetFile-60"><span class="linenos">60</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; &quot;&quot;&quot;</span>
</span><span id="TarZstdFernetFile-61"><a href="#TarZstdFernetFile-61"><span class="linenos">61</span></a>        <span class="n">s</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fernet_file</span><span class="p">)</span>
</span><span id="TarZstdFernetFile-62"><a href="#TarZstdFernetFile-62"><span class="linenos">62</span></a>        <span class="k">return</span> <span class="s1">&#39;&lt;TarZstdFernet &#39;</span> <span class="o">+</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">hex</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;&gt;&#39;</span>
</span></pre></div>


            <div class="docstring"><p>The container of the store. Based on TarFfile with encryption</p>
</div>


                            <div id="TarZstdFernetFile.__init__" class="classattr">
                                        <input id="TarZstdFernetFile.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">TarZstdFernetFile</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">name</span>, </span><span class="param"><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span>, </span><span class="param"><span class="n">fileobj</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">fernet_key</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span>)</span>

                <label class="view-source-button" for="TarZstdFernetFile.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TarZstdFernetFile.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TarZstdFernetFile.__init__-35"><a href="#TarZstdFernetFile.__init__-35"><span class="linenos">35</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">fileobj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fernet_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="TarZstdFernetFile.__init__-36"><a href="#TarZstdFernetFile.__init__-36"><span class="linenos">36</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Init the TarZstdFernetFile&quot;&quot;&quot;</span>
</span><span id="TarZstdFernetFile.__init__-37"><a href="#TarZstdFernetFile.__init__-37"><span class="linenos">37</span></a>        <span class="n">level_or_option</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;level_or_option&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="TarZstdFernetFile.__init__-38"><a href="#TarZstdFernetFile.__init__-38"><span class="linenos">38</span></a>        <span class="n">zstd_dict</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;zstd_dict&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="TarZstdFernetFile.__init__-39"><a href="#TarZstdFernetFile.__init__-39"><span class="linenos">39</span></a>        <span class="n">chunk_size</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;chunk_size&#39;</span><span class="p">,</span> <span class="n">CHUNK_SIZE</span><span class="p">)</span>
</span><span id="TarZstdFernetFile.__init__-40"><a href="#TarZstdFernetFile.__init__-40"><span class="linenos">40</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fernet_file</span> <span class="o">=</span> <span class="n">ZstdFernetFile</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">fileobj</span><span class="o">=</span><span class="n">fileobj</span><span class="p">,</span>
</span><span id="TarZstdFernetFile.__init__-41"><a href="#TarZstdFernetFile.__init__-41"><span class="linenos">41</span></a>            <span class="n">fernet_key</span><span class="o">=</span><span class="n">fernet_key</span><span class="p">,</span> <span class="n">level_or_option</span><span class="o">=</span><span class="n">level_or_option</span><span class="p">,</span>
</span><span id="TarZstdFernetFile.__init__-42"><a href="#TarZstdFernetFile.__init__-42"><span class="linenos">42</span></a>                <span class="n">zstd_dict</span><span class="o">=</span><span class="n">zstd_dict</span><span class="p">,</span> <span class="n">chunk_size</span><span class="o">=</span><span class="n">chunk_size</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="TarZstdFernetFile.__init__-43"><a href="#TarZstdFernetFile.__init__-43"><span class="linenos">43</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="TarZstdFernetFile.__init__-44"><a href="#TarZstdFernetFile.__init__-44"><span class="linenos">44</span></a>            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">fileobj</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fernet_file</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="TarZstdFernetFile.__init__-45"><a href="#TarZstdFernetFile.__init__-45"><span class="linenos">45</span></a>
</span><span id="TarZstdFernetFile.__init__-46"><a href="#TarZstdFernetFile.__init__-46"><span class="linenos">46</span></a>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="TarZstdFernetFile.__init__-47"><a href="#TarZstdFernetFile.__init__-47"><span class="linenos">47</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">fernet_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="TarZstdFernetFile.__init__-48"><a href="#TarZstdFernetFile.__init__-48"><span class="linenos">48</span></a>            <span class="k">raise</span>
</span></pre></div>


            <div class="docstring"><p>Init the TarZstdFernetFile</p>
</div>


                            </div>
                            <div id="TarZstdFernetFile.fernet_file" class="classattr">
                                <div class="attr variable">
            <span class="name">fernet_file</span>

        
    </div>
    <a class="headerlink" href="#TarZstdFernetFile.fernet_file"></a>
    
    

                            </div>
                            <div id="TarZstdFernetFile.close" class="classattr">
                                        <input id="TarZstdFernetFile.close-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">close</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TarZstdFernetFile.close-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TarZstdFernetFile.close"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TarZstdFernetFile.close-50"><a href="#TarZstdFernetFile.close-50"><span class="linenos">50</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="TarZstdFernetFile.close-51"><a href="#TarZstdFernetFile.close-51"><span class="linenos">51</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Close the TarZstdFernetFile&quot;&quot;&quot;</span>
</span><span id="TarZstdFernetFile.close-52"><a href="#TarZstdFernetFile.close-52"><span class="linenos">52</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="TarZstdFernetFile.close-53"><a href="#TarZstdFernetFile.close-53"><span class="linenos">53</span></a>            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="TarZstdFernetFile.close-54"><a href="#TarZstdFernetFile.close-54"><span class="linenos">54</span></a>
</span><span id="TarZstdFernetFile.close-55"><a href="#TarZstdFernetFile.close-55"><span class="linenos">55</span></a>        <span class="k">finally</span><span class="p">:</span>
</span><span id="TarZstdFernetFile.close-56"><a href="#TarZstdFernetFile.close-56"><span class="linenos">56</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fernet_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TarZstdFernetFile.close-57"><a href="#TarZstdFernetFile.close-57"><span class="linenos">57</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">fernet_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Close the TarZstdFernetFile</p>
</div>


                            </div>
                </section>
                <section id="StoreInfo">
                            <input id="StoreInfo-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">StoreInfo</span>:

                <label class="view-source-button" for="StoreInfo-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StoreInfo"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StoreInfo-65"><a href="#StoreInfo-65"><span class="linenos">65</span></a><span class="k">class</span><span class="w"> </span><span class="nc">StoreInfo</span><span class="p">():</span>
</span><span id="StoreInfo-66"><a href="#StoreInfo-66"><span class="linenos">66</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot; &quot;&quot;&quot;</span>
</span><span id="StoreInfo-67"><a href="#StoreInfo-67"><span class="linenos">67</span></a>
</span><span id="StoreInfo-68"><a href="#StoreInfo-68"><span class="linenos">68</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">store_path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="StoreInfo-69"><a href="#StoreInfo-69"><span class="linenos">69</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;A representation of the file in tmp&quot;&quot;&quot;</span>
</span><span id="StoreInfo-70"><a href="#StoreInfo-70"><span class="linenos">70</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">store_path</span> <span class="o">=</span> <span class="n">store_path</span>
</span><span id="StoreInfo-71"><a href="#StoreInfo-71"><span class="linenos">71</span></a>        <span class="n">sname</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span><span id="StoreInfo-72"><a href="#StoreInfo-72"><span class="linenos">72</span></a>        <span class="k">if</span> <span class="n">sname</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span>
</span><span id="StoreInfo-73"><a href="#StoreInfo-73"><span class="linenos">73</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">sname</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="StoreInfo-74"><a href="#StoreInfo-74"><span class="linenos">74</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="StoreInfo-75"><a href="#StoreInfo-75"><span class="linenos">75</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">sname</span>
</span><span id="StoreInfo-76"><a href="#StoreInfo-76"><span class="linenos">76</span></a>        <span class="n">dirs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="StoreInfo-77"><a href="#StoreInfo-77"><span class="linenos">77</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dirs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="p">:</span>
</span><span id="StoreInfo-78"><a href="#StoreInfo-78"><span class="linenos">78</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">subdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store_path</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">dirs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="StoreInfo-79"><a href="#StoreInfo-79"><span class="linenos">79</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dirpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">subdir</span><span class="p">)</span>
</span><span id="StoreInfo-80"><a href="#StoreInfo-80"><span class="linenos">80</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="StoreInfo-81"><a href="#StoreInfo-81"><span class="linenos">81</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">subdir</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="StoreInfo-82"><a href="#StoreInfo-82"><span class="linenos">82</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dirpath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">store_path</span>
</span><span id="StoreInfo-83"><a href="#StoreInfo-83"><span class="linenos">83</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store_path</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="StoreInfo-84"><a href="#StoreInfo-84"><span class="linenos">84</span></a>
</span><span id="StoreInfo-85"><a href="#StoreInfo-85"><span class="linenos">85</span></a>    <span class="nd">@property</span>
</span><span id="StoreInfo-86"><a href="#StoreInfo-86"><span class="linenos">86</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">mtime</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StoreInfo-87"><a href="#StoreInfo-87"><span class="linenos">87</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The mtime of the file in tmp&quot;&quot;&quot;</span>
</span><span id="StoreInfo-88"><a href="#StoreInfo-88"><span class="linenos">88</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">):</span>
</span><span id="StoreInfo-89"><a href="#StoreInfo-89"><span class="linenos">89</span></a>            <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</span><span id="StoreInfo-90"><a href="#StoreInfo-90"><span class="linenos">90</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="StoreInfo-91"><a href="#StoreInfo-91"><span class="linenos">91</span></a>
</span><span id="StoreInfo-92"><a href="#StoreInfo-92"><span class="linenos">92</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StoreInfo-93"><a href="#StoreInfo-93"><span class="linenos">93</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; &quot;&quot;&quot;</span>
</span><span id="StoreInfo-94"><a href="#StoreInfo-94"><span class="linenos">94</span></a>        <span class="n">s</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="StoreInfo-95"><a href="#StoreInfo-95"><span class="linenos">95</span></a>        <span class="k">return</span> <span class="s1">&#39;&lt;FernetStoreInfo &#39;</span> <span class="o">+</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">hex</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;&gt;&#39;</span>
</span></pre></div>


    

                            <div id="StoreInfo.__init__" class="classattr">
                                        <input id="StoreInfo.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">StoreInfo</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">name</span>, </span><span class="param"><span class="n">store_path</span><span class="o">=</span><span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="StoreInfo.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StoreInfo.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StoreInfo.__init__-68"><a href="#StoreInfo.__init__-68"><span class="linenos">68</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">store_path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="StoreInfo.__init__-69"><a href="#StoreInfo.__init__-69"><span class="linenos">69</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;A representation of the file in tmp&quot;&quot;&quot;</span>
</span><span id="StoreInfo.__init__-70"><a href="#StoreInfo.__init__-70"><span class="linenos">70</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">store_path</span> <span class="o">=</span> <span class="n">store_path</span>
</span><span id="StoreInfo.__init__-71"><a href="#StoreInfo.__init__-71"><span class="linenos">71</span></a>        <span class="n">sname</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span><span id="StoreInfo.__init__-72"><a href="#StoreInfo.__init__-72"><span class="linenos">72</span></a>        <span class="k">if</span> <span class="n">sname</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span>
</span><span id="StoreInfo.__init__-73"><a href="#StoreInfo.__init__-73"><span class="linenos">73</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">sname</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="StoreInfo.__init__-74"><a href="#StoreInfo.__init__-74"><span class="linenos">74</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="StoreInfo.__init__-75"><a href="#StoreInfo.__init__-75"><span class="linenos">75</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">sname</span>
</span><span id="StoreInfo.__init__-76"><a href="#StoreInfo.__init__-76"><span class="linenos">76</span></a>        <span class="n">dirs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="StoreInfo.__init__-77"><a href="#StoreInfo.__init__-77"><span class="linenos">77</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dirs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="p">:</span>
</span><span id="StoreInfo.__init__-78"><a href="#StoreInfo.__init__-78"><span class="linenos">78</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">subdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store_path</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">dirs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="StoreInfo.__init__-79"><a href="#StoreInfo.__init__-79"><span class="linenos">79</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dirpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">subdir</span><span class="p">)</span>
</span><span id="StoreInfo.__init__-80"><a href="#StoreInfo.__init__-80"><span class="linenos">80</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="StoreInfo.__init__-81"><a href="#StoreInfo.__init__-81"><span class="linenos">81</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">subdir</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="StoreInfo.__init__-82"><a href="#StoreInfo.__init__-82"><span class="linenos">82</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dirpath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">store_path</span>
</span><span id="StoreInfo.__init__-83"><a href="#StoreInfo.__init__-83"><span class="linenos">83</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store_path</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>A representation of the file in tmp</p>
</div>


                            </div>
                            <div id="StoreInfo.store_path" class="classattr">
                                <div class="attr variable">
            <span class="name">store_path</span>

        
    </div>
    <a class="headerlink" href="#StoreInfo.store_path"></a>
    
    

                            </div>
                            <div id="StoreInfo.path" class="classattr">
                                <div class="attr variable">
            <span class="name">path</span>

        
    </div>
    <a class="headerlink" href="#StoreInfo.path"></a>
    
    

                            </div>
                            <div id="StoreInfo.mtime" class="classattr">
                                        <input id="StoreInfo.mtime-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">mtime</span>

                <label class="view-source-button" for="StoreInfo.mtime-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StoreInfo.mtime"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StoreInfo.mtime-85"><a href="#StoreInfo.mtime-85"><span class="linenos">85</span></a>    <span class="nd">@property</span>
</span><span id="StoreInfo.mtime-86"><a href="#StoreInfo.mtime-86"><span class="linenos">86</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">mtime</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StoreInfo.mtime-87"><a href="#StoreInfo.mtime-87"><span class="linenos">87</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The mtime of the file in tmp&quot;&quot;&quot;</span>
</span><span id="StoreInfo.mtime-88"><a href="#StoreInfo.mtime-88"><span class="linenos">88</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">):</span>
</span><span id="StoreInfo.mtime-89"><a href="#StoreInfo.mtime-89"><span class="linenos">89</span></a>            <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</span><span id="StoreInfo.mtime-90"><a href="#StoreInfo.mtime-90"><span class="linenos">90</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>The mtime of the file in tmp</p>
</div>


                            </div>
                </section>
                <section id="FernetStore">
                            <input id="FernetStore-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">FernetStore</span>:

                <label class="view-source-button" for="FernetStore-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FernetStore"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FernetStore-97"><a href="#FernetStore-97"><span class="linenos"> 97</span></a><span class="k">class</span><span class="w"> </span><span class="nc">FernetStore</span><span class="p">():</span>
</span><span id="FernetStore-98"><a href="#FernetStore-98"><span class="linenos"> 98</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot; &quot;&quot;&quot;</span>
</span><span id="FernetStore-99"><a href="#FernetStore-99"><span class="linenos"> 99</span></a>
</span><span id="FernetStore-100"><a href="#FernetStore-100"><span class="linenos">100</span></a>    <span class="n">filename</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="FernetStore-101"><a href="#FernetStore-101"><span class="linenos">101</span></a>
</span><span id="FernetStore-102"><a href="#FernetStore-102"><span class="linenos">102</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fernet_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fileobj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="FernetStore-103"><a href="#FernetStore-103"><span class="linenos">103</span></a>            <span class="n">secure_open</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">secure_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">auto_flush</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="FernetStore-104"><a href="#FernetStore-104"><span class="linenos">104</span></a>            <span class="n">backup</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="FernetStore-105"><a href="#FernetStore-105"><span class="linenos">105</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Constructor for the FernetFile class.</span>
</span><span id="FernetStore-106"><a href="#FernetStore-106"><span class="linenos">106</span></a>
</span><span id="FernetStore-107"><a href="#FernetStore-107"><span class="linenos">107</span></a><span class="sd">        At least one of fileobj and filename must be given a</span>
</span><span id="FernetStore-108"><a href="#FernetStore-108"><span class="linenos">108</span></a><span class="sd">        non-trivial value.</span>
</span><span id="FernetStore-109"><a href="#FernetStore-109"><span class="linenos">109</span></a>
</span><span id="FernetStore-110"><a href="#FernetStore-110"><span class="linenos">110</span></a><span class="sd">        The new class instance is based on fileobj, which can be a regular</span>
</span><span id="FernetStore-111"><a href="#FernetStore-111"><span class="linenos">111</span></a><span class="sd">        file, an io.BytesIO object, or any other object which simulates a file.</span>
</span><span id="FernetStore-112"><a href="#FernetStore-112"><span class="linenos">112</span></a><span class="sd">        It defaults to None, in which case filename is opened to provide</span>
</span><span id="FernetStore-113"><a href="#FernetStore-113"><span class="linenos">113</span></a><span class="sd">        a file object.</span>
</span><span id="FernetStore-114"><a href="#FernetStore-114"><span class="linenos">114</span></a>
</span><span id="FernetStore-115"><a href="#FernetStore-115"><span class="linenos">115</span></a><span class="sd">        When fileobj is not None, the filename argument is only used to be</span>
</span><span id="FernetStore-116"><a href="#FernetStore-116"><span class="linenos">116</span></a><span class="sd">        included in the gzip file header, which may include the original</span>
</span><span id="FernetStore-117"><a href="#FernetStore-117"><span class="linenos">117</span></a><span class="sd">        filename of the uncompressed file.  It defaults to the filename of</span>
</span><span id="FernetStore-118"><a href="#FernetStore-118"><span class="linenos">118</span></a><span class="sd">        fileobj, if discernible; otherwise, it defaults to the empty string,</span>
</span><span id="FernetStore-119"><a href="#FernetStore-119"><span class="linenos">119</span></a><span class="sd">        and in this case the original filename is not included in the header.</span>
</span><span id="FernetStore-120"><a href="#FernetStore-120"><span class="linenos">120</span></a>
</span><span id="FernetStore-121"><a href="#FernetStore-121"><span class="linenos">121</span></a><span class="sd">        The mode argument can be any of &#39;r&#39;, &#39;rb&#39;, &#39;a&#39;, &#39;ab&#39;, &#39;w&#39;, &#39;wb&#39;, &#39;x&#39;, or</span>
</span><span id="FernetStore-122"><a href="#FernetStore-122"><span class="linenos">122</span></a><span class="sd">        &#39;xb&#39; depending on whether the file will be read or written.  The default</span>
</span><span id="FernetStore-123"><a href="#FernetStore-123"><span class="linenos">123</span></a><span class="sd">        is the mode of fileobj if discernible; otherwise, the default is &#39;rb&#39;.</span>
</span><span id="FernetStore-124"><a href="#FernetStore-124"><span class="linenos">124</span></a><span class="sd">        A mode of &#39;r&#39; is equivalent to one of &#39;rb&#39;, and similarly for &#39;w&#39; and</span>
</span><span id="FernetStore-125"><a href="#FernetStore-125"><span class="linenos">125</span></a><span class="sd">        &#39;wb&#39;, &#39;a&#39; and &#39;ab&#39;, and &#39;x&#39; and &#39;xb&#39;.</span>
</span><span id="FernetStore-126"><a href="#FernetStore-126"><span class="linenos">126</span></a>
</span><span id="FernetStore-127"><a href="#FernetStore-127"><span class="linenos">127</span></a><span class="sd">        The fernet_key argument is the Fernet key used to crypt/decrypt data.</span>
</span><span id="FernetStore-128"><a href="#FernetStore-128"><span class="linenos">128</span></a><span class="sd">        Encryption is done by chunks to reduce memory footprint. The default</span>
</span><span id="FernetStore-129"><a href="#FernetStore-129"><span class="linenos">129</span></a><span class="sd">        chunk_size is 64KB.</span>
</span><span id="FernetStore-130"><a href="#FernetStore-130"><span class="linenos">130</span></a>
</span><span id="FernetStore-131"><a href="#FernetStore-131"><span class="linenos">131</span></a><span class="sd">        Files are stored in clear mode when opening archive (in a directory in /tmp).</span>
</span><span id="FernetStore-132"><a href="#FernetStore-132"><span class="linenos">132</span></a><span class="sd">        You can give a &quot;secured open&quot; command to avoid that (in dev)</span>
</span><span id="FernetStore-133"><a href="#FernetStore-133"><span class="linenos">133</span></a>
</span><span id="FernetStore-134"><a href="#FernetStore-134"><span class="linenos">134</span></a><span class="sd">        Everytime data are written in archive, it is flushed to file : this means</span>
</span><span id="FernetStore-135"><a href="#FernetStore-135"><span class="linenos">135</span></a><span class="sd">        that thar archive is compressed and crypted. You can change this with auto_flush.</span>
</span><span id="FernetStore-136"><a href="#FernetStore-136"><span class="linenos">136</span></a><span class="sd">        Data will be flushed only on close.</span>
</span><span id="FernetStore-137"><a href="#FernetStore-137"><span class="linenos">137</span></a>
</span><span id="FernetStore-138"><a href="#FernetStore-138"><span class="linenos">138</span></a><span class="sd">        This store is thread safe, this allows you to flush from a timer for example.</span>
</span><span id="FernetStore-139"><a href="#FernetStore-139"><span class="linenos">139</span></a>
</span><span id="FernetStore-140"><a href="#FernetStore-140"><span class="linenos">140</span></a><span class="sd">        If you want to backup archive before flushing it, pass extention to this parameter.</span>
</span><span id="FernetStore-141"><a href="#FernetStore-141"><span class="linenos">141</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="FernetStore-142"><a href="#FernetStore-142"><span class="linenos">142</span></a>        <span class="k">if</span> <span class="n">fernet_key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="FernetStore-143"><a href="#FernetStore-143"><span class="linenos">143</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid fernet key: </span><span class="si">{!r}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fernet_key</span><span class="p">))</span>
</span><span id="FernetStore-144"><a href="#FernetStore-144"><span class="linenos">144</span></a>        <span class="k">if</span> <span class="n">mode</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;t&#39;</span> <span class="ow">in</span> <span class="n">mode</span> <span class="ow">or</span> <span class="s1">&#39;U&#39;</span> <span class="ow">in</span> <span class="n">mode</span><span class="p">):</span>
</span><span id="FernetStore-145"><a href="#FernetStore-145"><span class="linenos">145</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid mode: </span><span class="si">{!r}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mode</span><span class="p">))</span>
</span><span id="FernetStore-146"><a href="#FernetStore-146"><span class="linenos">146</span></a>        <span class="k">if</span> <span class="n">mode</span> <span class="ow">and</span> <span class="s1">&#39;b&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">mode</span><span class="p">:</span>
</span><span id="FernetStore-147"><a href="#FernetStore-147"><span class="linenos">147</span></a>            <span class="n">mode</span> <span class="o">+=</span> <span class="s1">&#39;b&#39;</span>
</span><span id="FernetStore-148"><a href="#FernetStore-148"><span class="linenos">148</span></a>        <span class="k">if</span> <span class="n">mode</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">):</span>
</span><span id="FernetStore-149"><a href="#FernetStore-149"><span class="linenos">149</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">READ</span>
</span><span id="FernetStore-150"><a href="#FernetStore-150"><span class="linenos">150</span></a>        <span class="k">elif</span> <span class="n">mode</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">):</span>
</span><span id="FernetStore-151"><a href="#FernetStore-151"><span class="linenos">151</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">WRITE</span>
</span><span id="FernetStore-152"><a href="#FernetStore-152"><span class="linenos">152</span></a>        <span class="k">elif</span> <span class="n">mode</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">):</span>
</span><span id="FernetStore-153"><a href="#FernetStore-153"><span class="linenos">153</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">APPEND</span>
</span><span id="FernetStore-154"><a href="#FernetStore-154"><span class="linenos">154</span></a>        <span class="k">elif</span> <span class="n">mode</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">):</span>
</span><span id="FernetStore-155"><a href="#FernetStore-155"><span class="linenos">155</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">EXCLUSIVE</span>
</span><span id="FernetStore-156"><a href="#FernetStore-156"><span class="linenos">156</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="FernetStore-157"><a href="#FernetStore-157"><span class="linenos">157</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid mode: </span><span class="si">{!r}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mode</span><span class="p">))</span>
</span><span id="FernetStore-158"><a href="#FernetStore-158"><span class="linenos">158</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
</span><span id="FernetStore-159"><a href="#FernetStore-159"><span class="linenos">159</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fernet_key</span> <span class="o">=</span> <span class="n">fernet_key</span>
</span><span id="FernetStore-160"><a href="#FernetStore-160"><span class="linenos">160</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>
</span><span id="FernetStore-161"><a href="#FernetStore-161"><span class="linenos">161</span></a>        <span class="k">if</span> <span class="n">fileobj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="FernetStore-162"><a href="#FernetStore-162"><span class="linenos">162</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">fileobj</span><span class="o">.</span><span class="n">name</span>
</span><span id="FernetStore-163"><a href="#FernetStore-163"><span class="linenos">163</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">fileobj</span> <span class="o">=</span> <span class="n">fileobj</span>
</span><span id="FernetStore-164"><a href="#FernetStore-164"><span class="linenos">164</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="FernetStore-165"><a href="#FernetStore-165"><span class="linenos">165</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
</span><span id="FernetStore-166"><a href="#FernetStore-166"><span class="linenos">166</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">fileobj</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="FernetStore-167"><a href="#FernetStore-167"><span class="linenos">167</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="FernetStore-168"><a href="#FernetStore-168"><span class="linenos">168</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid filename: </span><span class="si">{!r}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
</span><span id="FernetStore-169"><a href="#FernetStore-169"><span class="linenos">169</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">backup</span> <span class="o">=</span> <span class="n">backup</span>
</span><span id="FernetStore-170"><a href="#FernetStore-170"><span class="linenos">170</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">auto_flush</span> <span class="o">=</span> <span class="n">auto_flush</span>
</span><span id="FernetStore-171"><a href="#FernetStore-171"><span class="linenos">171</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_lockfile</span> <span class="o">=</span> <span class="n">FileLock</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">+</span><span class="s1">&#39;.lock&#39;</span><span class="p">)</span>
</span><span id="FernetStore-172"><a href="#FernetStore-172"><span class="linenos">172</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">secure_open</span> <span class="o">=</span> <span class="n">_open</span>
</span><span id="FernetStore-173"><a href="#FernetStore-173"><span class="linenos">173</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">secure_params</span> <span class="o">=</span> <span class="n">secure_params</span>
</span><span id="FernetStore-174"><a href="#FernetStore-174"><span class="linenos">174</span></a>        <span class="k">if</span> <span class="n">secure_open</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="FernetStore-175"><a href="#FernetStore-175"><span class="linenos">175</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">secure_open</span> <span class="o">=</span> <span class="n">secure_open</span>
</span><span id="FernetStore-176"><a href="#FernetStore-176"><span class="linenos">176</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">secure_params</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="FernetStore-177"><a href="#FernetStore-177"><span class="linenos">177</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">secure_params</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="FernetStore-178"><a href="#FernetStore-178"><span class="linenos">178</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dirpath</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="FernetStore-179"><a href="#FernetStore-179"><span class="linenos">179</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirctime</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="FernetStore-180"><a href="#FernetStore-180"><span class="linenos">180</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirmtime</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="FernetStore-181"><a href="#FernetStore-181"><span class="linenos">181</span></a>
</span><span id="FernetStore-182"><a href="#FernetStore-182"><span class="linenos">182</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="FernetStore-183"><a href="#FernetStore-183"><span class="linenos">183</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;A repr of the store&quot;&quot;&quot;</span>
</span><span id="FernetStore-184"><a href="#FernetStore-184"><span class="linenos">184</span></a>        <span class="n">s</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
</span><span id="FernetStore-185"><a href="#FernetStore-185"><span class="linenos">185</span></a>        <span class="k">return</span> <span class="s1">&#39;&lt;FernetStore &#39;</span> <span class="o">+</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">hex</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;&gt;&#39;</span>
</span><span id="FernetStore-186"><a href="#FernetStore-186"><span class="linenos">186</span></a>
</span><span id="FernetStore-187"><a href="#FernetStore-187"><span class="linenos">187</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_check_not_closed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="FernetStore-188"><a href="#FernetStore-188"><span class="linenos">188</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if the store is closed&quot;&quot;&quot;</span>
</span><span id="FernetStore-189"><a href="#FernetStore-189"><span class="linenos">189</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">closed</span><span class="p">:</span>
</span><span id="FernetStore-190"><a href="#FernetStore-190"><span class="linenos">190</span></a>            <span class="k">raise</span> <span class="n">io</span><span class="o">.</span><span class="n">UnsupportedOperation</span><span class="p">(</span><span class="s2">&quot;I/O operation on closed file&quot;</span><span class="p">)</span>
</span><span id="FernetStore-191"><a href="#FernetStore-191"><span class="linenos">191</span></a>
</span><span id="FernetStore-192"><a href="#FernetStore-192"><span class="linenos">192</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_check_can_write</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="FernetStore-193"><a href="#FernetStore-193"><span class="linenos">193</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check we can write in store&quot;&quot;&quot;</span>
</span><span id="FernetStore-194"><a href="#FernetStore-194"><span class="linenos">194</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">closed</span><span class="p">:</span>
</span><span id="FernetStore-195"><a href="#FernetStore-195"><span class="linenos">195</span></a>            <span class="k">raise</span> <span class="n">io</span><span class="o">.</span><span class="n">UnsupportedOperation</span><span class="p">(</span><span class="s2">&quot;I/O operation on closed file&quot;</span><span class="p">)</span>
</span><span id="FernetStore-196"><a href="#FernetStore-196"><span class="linenos">196</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">writable</span><span class="p">:</span>
</span><span id="FernetStore-197"><a href="#FernetStore-197"><span class="linenos">197</span></a>            <span class="k">raise</span> <span class="n">io</span><span class="o">.</span><span class="n">UnsupportedOperation</span><span class="p">(</span><span class="s2">&quot;File not open for writing&quot;</span><span class="p">)</span>
</span><span id="FernetStore-198"><a href="#FernetStore-198"><span class="linenos">198</span></a>
</span><span id="FernetStore-199"><a href="#FernetStore-199"><span class="linenos">199</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_check_can_read</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="FernetStore-200"><a href="#FernetStore-200"><span class="linenos">200</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check we can read in store&quot;&quot;&quot;</span>
</span><span id="FernetStore-201"><a href="#FernetStore-201"><span class="linenos">201</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">closed</span><span class="p">:</span>
</span><span id="FernetStore-202"><a href="#FernetStore-202"><span class="linenos">202</span></a>            <span class="k">raise</span> <span class="n">io</span><span class="o">.</span><span class="n">UnsupportedOperation</span><span class="p">(</span><span class="s2">&quot;I/O operation on closed file&quot;</span><span class="p">)</span>
</span><span id="FernetStore-203"><a href="#FernetStore-203"><span class="linenos">203</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">readable</span><span class="p">:</span>
</span><span id="FernetStore-204"><a href="#FernetStore-204"><span class="linenos">204</span></a>            <span class="k">raise</span> <span class="n">io</span><span class="o">.</span><span class="n">UnsupportedOperation</span><span class="p">(</span><span class="s2">&quot;File not open for reading&quot;</span><span class="p">)</span>
</span><span id="FernetStore-205"><a href="#FernetStore-205"><span class="linenos">205</span></a>
</span><span id="FernetStore-206"><a href="#FernetStore-206"><span class="linenos">206</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="FernetStore-207"><a href="#FernetStore-207"><span class="linenos">207</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Enter context manager&quot;&quot;&quot;</span>
</span><span id="FernetStore-208"><a href="#FernetStore-208"><span class="linenos">208</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>
</span><span id="FernetStore-209"><a href="#FernetStore-209"><span class="linenos">209</span></a>
</span><span id="FernetStore-210"><a href="#FernetStore-210"><span class="linenos">210</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">):</span>
</span><span id="FernetStore-211"><a href="#FernetStore-211"><span class="linenos">211</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Exit context manager&quot;&quot;&quot;</span>
</span><span id="FernetStore-212"><a href="#FernetStore-212"><span class="linenos">212</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="FernetStore-213"><a href="#FernetStore-213"><span class="linenos">213</span></a>
</span><span id="FernetStore-214"><a href="#FernetStore-214"><span class="linenos">214</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="FernetStore-215"><a href="#FernetStore-215"><span class="linenos">215</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Open the store with a lock&quot;&quot;&quot;</span>
</span><span id="FernetStore-216"><a href="#FernetStore-216"><span class="linenos">216</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_lockfile</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
</span><span id="FernetStore-217"><a href="#FernetStore-217"><span class="linenos">217</span></a>        <span class="n">file_exists</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
</span><span id="FernetStore-218"><a href="#FernetStore-218"><span class="linenos">218</span></a>        <span class="k">if</span> <span class="n">file_exists</span><span class="p">:</span>
</span><span id="FernetStore-219"><a href="#FernetStore-219"><span class="linenos">219</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">EXCLUSIVE</span><span class="p">:</span>
</span><span id="FernetStore-220"><a href="#FernetStore-220"><span class="linenos">220</span></a>                <span class="k">raise</span> <span class="ne">FileExistsError</span><span class="p">(</span><span class="s1">&#39;File already exists </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
</span><span id="FernetStore-221"><a href="#FernetStore-221"><span class="linenos">221</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="FernetStore-222"><a href="#FernetStore-222"><span class="linenos">222</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">READ</span><span class="p">:</span>
</span><span id="FernetStore-223"><a href="#FernetStore-223"><span class="linenos">223</span></a>                <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s1">&#39;File not found </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
</span><span id="FernetStore-224"><a href="#FernetStore-224"><span class="linenos">224</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dirpath</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;.fernet_&quot;</span><span class="p">)</span>
</span><span id="FernetStore-225"><a href="#FernetStore-225"><span class="linenos">225</span></a>        <span class="k">if</span> <span class="n">file_exists</span><span class="p">:</span>
</span><span id="FernetStore-226"><a href="#FernetStore-226"><span class="linenos">226</span></a>            <span class="k">with</span> <span class="n">TarZstdFernetFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;rb&#39;</span><span class="p">,</span> <span class="n">fileobj</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fileobj</span><span class="p">,</span> <span class="n">fernet_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fernet_key</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">as</span> <span class="n">tff</span><span class="p">:</span>
</span><span id="FernetStore-227"><a href="#FernetStore-227"><span class="linenos">227</span></a>                <span class="n">tff</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dirpath</span><span class="p">)</span>
</span><span id="FernetStore-228"><a href="#FernetStore-228"><span class="linenos">228</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirctime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dirmtime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time_ns</span><span class="p">()</span>
</span><span id="FernetStore-229"><a href="#FernetStore-229"><span class="linenos">229</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="FernetStore-230"><a href="#FernetStore-230"><span class="linenos">230</span></a>
</span><span id="FernetStore-231"><a href="#FernetStore-231"><span class="linenos">231</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_write_store</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="FernetStore-232"><a href="#FernetStore-232"><span class="linenos">232</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Write the store in filename&quot;&quot;&quot;</span>
</span><span id="FernetStore-233"><a href="#FernetStore-233"><span class="linenos">233</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_can_write</span><span class="p">()</span>
</span><span id="FernetStore-234"><a href="#FernetStore-234"><span class="linenos">234</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
</span><span id="FernetStore-235"><a href="#FernetStore-235"><span class="linenos">235</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">backup</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="FernetStore-236"><a href="#FernetStore-236"><span class="linenos">236</span></a>                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">backup</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="FernetStore-237"><a href="#FernetStore-237"><span class="linenos">237</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">backup</span><span class="p">)</span>
</span><span id="FernetStore-238"><a href="#FernetStore-238"><span class="linenos">238</span></a>                <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">backup</span><span class="p">)</span>
</span><span id="FernetStore-239"><a href="#FernetStore-239"><span class="linenos">239</span></a>
</span><span id="FernetStore-240"><a href="#FernetStore-240"><span class="linenos">240</span></a>            <span class="k">with</span> <span class="n">TarZstdFernetFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;wb&#39;</span><span class="p">,</span> <span class="n">fileobj</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fileobj</span><span class="p">,</span> <span class="n">fernet_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fernet_key</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">as</span> <span class="n">tff</span><span class="p">:</span>
</span><span id="FernetStore-241"><a href="#FernetStore-241"><span class="linenos">241</span></a>                <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getmembers</span><span class="p">():</span>
</span><span id="FernetStore-242"><a href="#FernetStore-242"><span class="linenos">242</span></a>                    <span class="n">tff</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">member</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">arcname</span><span class="o">=</span><span class="n">member</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="FernetStore-243"><a href="#FernetStore-243"><span class="linenos">243</span></a>
</span><span id="FernetStore-244"><a href="#FernetStore-244"><span class="linenos">244</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_dirctime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dirmtime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time_ns</span><span class="p">()</span>
</span><span id="FernetStore-245"><a href="#FernetStore-245"><span class="linenos">245</span></a>
</span><span id="FernetStore-246"><a href="#FernetStore-246"><span class="linenos">246</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">getmembers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="FernetStore-247"><a href="#FernetStore-247"><span class="linenos">247</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get members or the store&quot;&quot;&quot;</span>
</span><span id="FernetStore-248"><a href="#FernetStore-248"><span class="linenos">248</span></a>        <span class="n">members</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="FernetStore-249"><a href="#FernetStore-249"><span class="linenos">249</span></a>        <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dirpath</span><span class="p">):</span>
</span><span id="FernetStore-250"><a href="#FernetStore-250"><span class="linenos">250</span></a>            <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
</span><span id="FernetStore-251"><a href="#FernetStore-251"><span class="linenos">251</span></a>                <span class="n">aname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="n">root</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dirpath</span><span class="p">):],</span> <span class="n">fname</span> <span class="p">)</span>
</span><span id="FernetStore-252"><a href="#FernetStore-252"><span class="linenos">252</span></a>                <span class="n">members</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">StoreInfo</span><span class="p">(</span><span class="n">aname</span><span class="p">,</span> <span class="n">store_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dirpath</span><span class="p">))</span>
</span><span id="FernetStore-253"><a href="#FernetStore-253"><span class="linenos">253</span></a>        <span class="k">return</span> <span class="n">members</span>
</span><span id="FernetStore-254"><a href="#FernetStore-254"><span class="linenos">254</span></a>
</span><span id="FernetStore-255"><a href="#FernetStore-255"><span class="linenos">255</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="FernetStore-256"><a href="#FernetStore-256"><span class="linenos">256</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Close the store. If file is open for writing, the store is rewriting&quot;&quot;&quot;</span>
</span><span id="FernetStore-257"><a href="#FernetStore-257"><span class="linenos">257</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">writable</span><span class="p">:</span>
</span><span id="FernetStore-258"><a href="#FernetStore-258"><span class="linenos">258</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_write_store</span><span class="p">()</span>
</span><span id="FernetStore-259"><a href="#FernetStore-259"><span class="linenos">259</span></a>        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dirpath</span><span class="p">)</span>
</span><span id="FernetStore-260"><a href="#FernetStore-260"><span class="linenos">260</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dirpath</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="FernetStore-261"><a href="#FernetStore-261"><span class="linenos">261</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirctime</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="FernetStore-262"><a href="#FernetStore-262"><span class="linenos">262</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirmtime</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="FernetStore-263"><a href="#FernetStore-263"><span class="linenos">263</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_lockfile</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
</span><span id="FernetStore-264"><a href="#FernetStore-264"><span class="linenos">264</span></a>
</span><span id="FernetStore-265"><a href="#FernetStore-265"><span class="linenos">265</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">flush</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="FernetStore-266"><a href="#FernetStore-266"><span class="linenos">266</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Flush data to store if needed. Unless force is True &quot;&quot;&quot;</span>
</span><span id="FernetStore-267"><a href="#FernetStore-267"><span class="linenos">267</span></a>        <span class="k">if</span> <span class="n">force</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">modified</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
</span><span id="FernetStore-268"><a href="#FernetStore-268"><span class="linenos">268</span></a>            <span class="k">return</span>
</span><span id="FernetStore-269"><a href="#FernetStore-269"><span class="linenos">269</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_write_store</span><span class="p">()</span>
</span><span id="FernetStore-270"><a href="#FernetStore-270"><span class="linenos">270</span></a>
</span><span id="FernetStore-271"><a href="#FernetStore-271"><span class="linenos">271</span></a>    <span class="nd">@contextmanager</span>
</span><span id="FernetStore-272"><a href="#FernetStore-272"><span class="linenos">272</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arcname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;rb&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="FernetStore-273"><a href="#FernetStore-273"><span class="linenos">273</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a file descriptor on arcname&quot;&quot;&quot;</span>
</span><span id="FernetStore-274"><a href="#FernetStore-274"><span class="linenos">274</span></a>        <span class="n">fffile</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="FernetStore-275"><a href="#FernetStore-275"><span class="linenos">275</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
</span><span id="FernetStore-276"><a href="#FernetStore-276"><span class="linenos">276</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arcname</span><span class="p">,</span> <span class="n">StoreInfo</span><span class="p">):</span>
</span><span id="FernetStore-277"><a href="#FernetStore-277"><span class="linenos">277</span></a>                <span class="n">finfo</span> <span class="o">=</span> <span class="n">arcname</span>
</span><span id="FernetStore-278"><a href="#FernetStore-278"><span class="linenos">278</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="FernetStore-279"><a href="#FernetStore-279"><span class="linenos">279</span></a>                <span class="n">finfo</span> <span class="o">=</span> <span class="n">StoreInfo</span><span class="p">(</span><span class="n">arcname</span><span class="p">,</span> <span class="n">store_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dirpath</span><span class="p">)</span>
</span><span id="FernetStore-280"><a href="#FernetStore-280"><span class="linenos">280</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="FernetStore-281"><a href="#FernetStore-281"><span class="linenos">281</span></a>                <span class="k">if</span> <span class="n">finfo</span><span class="o">.</span><span class="n">subdir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="FernetStore-282"><a href="#FernetStore-282"><span class="linenos">282</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dirpath</span><span class="p">,</span> <span class="n">finfo</span><span class="o">.</span><span class="n">subdir</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="FernetStore-283"><a href="#FernetStore-283"><span class="linenos">283</span></a>                <span class="n">fffile</span> <span class="o">=</span> <span class="n">ffile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">secure_open</span><span class="p">(</span><span class="n">finfo</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">secure_params</span><span class="p">)</span>
</span><span id="FernetStore-284"><a href="#FernetStore-284"><span class="linenos">284</span></a>                <span class="k">yield</span> <span class="n">ffile</span>
</span><span id="FernetStore-285"><a href="#FernetStore-285"><span class="linenos">285</span></a>                <span class="n">ffile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="FernetStore-286"><a href="#FernetStore-286"><span class="linenos">286</span></a>                <span class="n">ffile</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="FernetStore-287"><a href="#FernetStore-287"><span class="linenos">287</span></a>                <span class="k">if</span> <span class="n">mode</span><span class="o">.</span><span class="n">startswith</span><span class="p">((</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">)):</span>
</span><span id="FernetStore-288"><a href="#FernetStore-288"><span class="linenos">288</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_dirmtime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time_ns</span><span class="p">()</span>
</span><span id="FernetStore-289"><a href="#FernetStore-289"><span class="linenos">289</span></a>            <span class="k">finally</span><span class="p">:</span>
</span><span id="FernetStore-290"><a href="#FernetStore-290"><span class="linenos">290</span></a>                <span class="k">if</span> <span class="n">fffile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="FernetStore-291"><a href="#FernetStore-291"><span class="linenos">291</span></a>                    <span class="n">fffile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="FernetStore-292"><a href="#FernetStore-292"><span class="linenos">292</span></a>                    <span class="n">fffile</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="FernetStore-293"><a href="#FernetStore-293"><span class="linenos">293</span></a>
</span><span id="FernetStore-294"><a href="#FernetStore-294"><span class="linenos">294</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_flush</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">mode</span><span class="o">.</span><span class="n">startswith</span><span class="p">((</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">)):</span>
</span><span id="FernetStore-295"><a href="#FernetStore-295"><span class="linenos">295</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="FernetStore-296"><a href="#FernetStore-296"><span class="linenos">296</span></a>
</span><span id="FernetStore-297"><a href="#FernetStore-297"><span class="linenos">297</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">arcname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="FernetStore-298"><a href="#FernetStore-298"><span class="linenos">298</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Add file as arcname. If arcname exists, it is replaced by default.</span>
</span><span id="FernetStore-299"><a href="#FernetStore-299"><span class="linenos">299</span></a><span class="sd">        Otherwise an exception is raised&quot;&quot;&quot;</span>
</span><span id="FernetStore-300"><a href="#FernetStore-300"><span class="linenos">300</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
</span><span id="FernetStore-301"><a href="#FernetStore-301"><span class="linenos">301</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_check_can_write</span><span class="p">()</span>
</span><span id="FernetStore-302"><a href="#FernetStore-302"><span class="linenos">302</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arcname</span><span class="p">,</span> <span class="n">StoreInfo</span><span class="p">):</span>
</span><span id="FernetStore-303"><a href="#FernetStore-303"><span class="linenos">303</span></a>                <span class="n">finfo</span> <span class="o">=</span> <span class="n">arcname</span>
</span><span id="FernetStore-304"><a href="#FernetStore-304"><span class="linenos">304</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="FernetStore-305"><a href="#FernetStore-305"><span class="linenos">305</span></a>                <span class="n">finfo</span> <span class="o">=</span> <span class="n">StoreInfo</span><span class="p">(</span><span class="n">arcname</span><span class="p">,</span> <span class="n">store_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dirpath</span><span class="p">)</span>
</span><span id="FernetStore-306"><a href="#FernetStore-306"><span class="linenos">306</span></a>
</span><span id="FernetStore-307"><a href="#FernetStore-307"><span class="linenos">307</span></a>            <span class="n">file_exists</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">finfo</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</span><span id="FernetStore-308"><a href="#FernetStore-308"><span class="linenos">308</span></a>            <span class="k">if</span> <span class="n">file_exists</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">replace</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
</span><span id="FernetStore-309"><a href="#FernetStore-309"><span class="linenos">309</span></a>                <span class="k">raise</span> <span class="ne">FileExistsError</span><span class="p">(</span><span class="s1">&#39;File already exists </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
</span><span id="FernetStore-310"><a href="#FernetStore-310"><span class="linenos">310</span></a>
</span><span id="FernetStore-311"><a href="#FernetStore-311"><span class="linenos">311</span></a>            <span class="k">if</span> <span class="n">file_exists</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="FernetStore-312"><a href="#FernetStore-312"><span class="linenos">312</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_delete</span><span class="p">(</span><span class="n">arcinfo</span><span class="o">=</span><span class="n">finfo</span><span class="p">)</span>
</span><span id="FernetStore-313"><a href="#FernetStore-313"><span class="linenos">313</span></a>
</span><span id="FernetStore-314"><a href="#FernetStore-314"><span class="linenos">314</span></a>            <span class="k">if</span> <span class="n">finfo</span><span class="o">.</span><span class="n">subdir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="FernetStore-315"><a href="#FernetStore-315"><span class="linenos">315</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dirpath</span><span class="p">,</span> <span class="n">finfo</span><span class="o">.</span><span class="n">subdir</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="FernetStore-316"><a href="#FernetStore-316"><span class="linenos">316</span></a>
</span><span id="FernetStore-317"><a href="#FernetStore-317"><span class="linenos">317</span></a>            <span class="k">with</span> <span class="n">_open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ff</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">secure_open</span><span class="p">(</span><span class="n">finfo</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;wb&#39;</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">secure_params</span><span class="p">)</span> <span class="k">as</span> <span class="n">sf</span><span class="p">:</span>
</span><span id="FernetStore-318"><a href="#FernetStore-318"><span class="linenos">318</span></a>                <span class="n">sf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ff</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</span><span id="FernetStore-319"><a href="#FernetStore-319"><span class="linenos">319</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_dirmtime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time_ns</span><span class="p">()</span>
</span><span id="FernetStore-320"><a href="#FernetStore-320"><span class="linenos">320</span></a>
</span><span id="FernetStore-321"><a href="#FernetStore-321"><span class="linenos">321</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_flush</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="FernetStore-322"><a href="#FernetStore-322"><span class="linenos">322</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="FernetStore-323"><a href="#FernetStore-323"><span class="linenos">323</span></a>
</span><span id="FernetStore-324"><a href="#FernetStore-324"><span class="linenos">324</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">extractall</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">members</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="FernetStore-325"><a href="#FernetStore-325"><span class="linenos">325</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract all files to path&quot;&quot;&quot;</span>
</span><span id="FernetStore-326"><a href="#FernetStore-326"><span class="linenos">326</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
</span><span id="FernetStore-327"><a href="#FernetStore-327"><span class="linenos">327</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_check_can_read</span><span class="p">()</span>
</span><span id="FernetStore-328"><a href="#FernetStore-328"><span class="linenos">328</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="FernetStore-329"><a href="#FernetStore-329"><span class="linenos">329</span></a>            <span class="k">if</span> <span class="n">members</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="FernetStore-330"><a href="#FernetStore-330"><span class="linenos">330</span></a>                <span class="n">members</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getmembers</span><span class="p">()</span>
</span><span id="FernetStore-331"><a href="#FernetStore-331"><span class="linenos">331</span></a>            <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="n">members</span><span class="p">:</span>
</span><span id="FernetStore-332"><a href="#FernetStore-332"><span class="linenos">332</span></a>                <span class="k">if</span> <span class="n">member</span><span class="o">.</span><span class="n">subdir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="FernetStore-333"><a href="#FernetStore-333"><span class="linenos">333</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">member</span><span class="o">.</span><span class="n">subdir</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="FernetStore-334"><a href="#FernetStore-334"><span class="linenos">334</span></a>
</span><span id="FernetStore-335"><a href="#FernetStore-335"><span class="linenos">335</span></a>                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">secure_open</span><span class="p">(</span><span class="n">member</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;rb&#39;</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">secure_params</span><span class="p">)</span> <span class="k">as</span> <span class="n">fin</span><span class="p">,</span> \
</span><span id="FernetStore-336"><a href="#FernetStore-336"><span class="linenos">336</span></a>                    <span class="n">_open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">member</span><span class="o">.</span><span class="n">name</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fout</span><span class="p">:</span>
</span><span id="FernetStore-337"><a href="#FernetStore-337"><span class="linenos">337</span></a>                        <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">fin</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</span><span id="FernetStore-338"><a href="#FernetStore-338"><span class="linenos">338</span></a>
</span><span id="FernetStore-339"><a href="#FernetStore-339"><span class="linenos">339</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arcinfo</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="FernetStore-340"><a href="#FernetStore-340"><span class="linenos">340</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete file in store without lock&quot;&quot;&quot;</span>
</span><span id="FernetStore-341"><a href="#FernetStore-341"><span class="linenos">341</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_can_write</span><span class="p">()</span>
</span><span id="FernetStore-342"><a href="#FernetStore-342"><span class="linenos">342</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">arcinfo</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</span><span id="FernetStore-343"><a href="#FernetStore-343"><span class="linenos">343</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirmtime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time_ns</span><span class="p">()</span>
</span><span id="FernetStore-344"><a href="#FernetStore-344"><span class="linenos">344</span></a>
</span><span id="FernetStore-345"><a href="#FernetStore-345"><span class="linenos">345</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arcname</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="FernetStore-346"><a href="#FernetStore-346"><span class="linenos">346</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete file in store&quot;&quot;&quot;</span>
</span><span id="FernetStore-347"><a href="#FernetStore-347"><span class="linenos">347</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
</span><span id="FernetStore-348"><a href="#FernetStore-348"><span class="linenos">348</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arcname</span><span class="p">,</span> <span class="n">StoreInfo</span><span class="p">):</span>
</span><span id="FernetStore-349"><a href="#FernetStore-349"><span class="linenos">349</span></a>                <span class="n">finfo</span> <span class="o">=</span> <span class="n">arcname</span>
</span><span id="FernetStore-350"><a href="#FernetStore-350"><span class="linenos">350</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="FernetStore-351"><a href="#FernetStore-351"><span class="linenos">351</span></a>                <span class="n">finfo</span> <span class="o">=</span> <span class="n">StoreInfo</span><span class="p">(</span><span class="n">arcname</span><span class="p">,</span> <span class="n">store_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dirpath</span><span class="p">)</span>
</span><span id="FernetStore-352"><a href="#FernetStore-352"><span class="linenos">352</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_delete</span><span class="p">(</span><span class="n">arcinfo</span><span class="o">=</span><span class="n">finfo</span><span class="p">)</span>
</span><span id="FernetStore-353"><a href="#FernetStore-353"><span class="linenos">353</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_flush</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="FernetStore-354"><a href="#FernetStore-354"><span class="linenos">354</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="FernetStore-355"><a href="#FernetStore-355"><span class="linenos">355</span></a>
</span><span id="FernetStore-356"><a href="#FernetStore-356"><span class="linenos">356</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">arcname</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="FernetStore-357"><a href="#FernetStore-357"><span class="linenos">357</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Append data to arcname&quot;&quot;&quot;</span>
</span><span id="FernetStore-358"><a href="#FernetStore-358"><span class="linenos">358</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_can_write</span><span class="p">()</span>
</span><span id="FernetStore-359"><a href="#FernetStore-359"><span class="linenos">359</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="p">(</span><span class="n">arcname</span><span class="o">=</span><span class="n">arcname</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;ab&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">nf</span><span class="p">:</span>
</span><span id="FernetStore-360"><a href="#FernetStore-360"><span class="linenos">360</span></a>            <span class="n">nf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="FernetStore-361"><a href="#FernetStore-361"><span class="linenos">361</span></a>
</span><span id="FernetStore-362"><a href="#FernetStore-362"><span class="linenos">362</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">arcname</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="FernetStore-363"><a href="#FernetStore-363"><span class="linenos">363</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Write data to arcname&quot;&quot;&quot;</span>
</span><span id="FernetStore-364"><a href="#FernetStore-364"><span class="linenos">364</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_can_write</span><span class="p">()</span>
</span><span id="FernetStore-365"><a href="#FernetStore-365"><span class="linenos">365</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="p">(</span><span class="n">arcname</span><span class="o">=</span><span class="n">arcname</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">nf</span><span class="p">:</span>
</span><span id="FernetStore-366"><a href="#FernetStore-366"><span class="linenos">366</span></a>            <span class="n">nf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="FernetStore-367"><a href="#FernetStore-367"><span class="linenos">367</span></a>
</span><span id="FernetStore-368"><a href="#FernetStore-368"><span class="linenos">368</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arcname</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="FernetStore-369"><a href="#FernetStore-369"><span class="linenos">369</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Read data from arcname&quot;&quot;&quot;</span>
</span><span id="FernetStore-370"><a href="#FernetStore-370"><span class="linenos">370</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_not_closed</span><span class="p">()</span>
</span><span id="FernetStore-371"><a href="#FernetStore-371"><span class="linenos">371</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="p">(</span><span class="n">arcname</span><span class="o">=</span><span class="n">arcname</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">nf</span><span class="p">:</span>
</span><span id="FernetStore-372"><a href="#FernetStore-372"><span class="linenos">372</span></a>            <span class="k">return</span> <span class="n">nf</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="FernetStore-373"><a href="#FernetStore-373"><span class="linenos">373</span></a>
</span><span id="FernetStore-374"><a href="#FernetStore-374"><span class="linenos">374</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">readlines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arcname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;UTF-8&#39;</span><span class="p">):</span>
</span><span id="FernetStore-375"><a href="#FernetStore-375"><span class="linenos">375</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Read a list of lines from arcname&quot;&quot;&quot;</span>
</span><span id="FernetStore-376"><a href="#FernetStore-376"><span class="linenos">376</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_not_closed</span><span class="p">()</span>
</span><span id="FernetStore-377"><a href="#FernetStore-377"><span class="linenos">377</span></a>        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="FernetStore-378"><a href="#FernetStore-378"><span class="linenos">378</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="p">(</span><span class="n">arcname</span><span class="o">=</span><span class="n">arcname</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;rt&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span> <span class="k">as</span> <span class="n">nf</span><span class="p">:</span>
</span><span id="FernetStore-379"><a href="#FernetStore-379"><span class="linenos">379</span></a>            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">nf</span><span class="p">:</span>
</span><span id="FernetStore-380"><a href="#FernetStore-380"><span class="linenos">380</span></a>                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">())</span>
</span><span id="FernetStore-381"><a href="#FernetStore-381"><span class="linenos">381</span></a>        <span class="k">return</span> <span class="n">lines</span>
</span><span id="FernetStore-382"><a href="#FernetStore-382"><span class="linenos">382</span></a>
</span><span id="FernetStore-383"><a href="#FernetStore-383"><span class="linenos">383</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">writelines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lines</span><span class="p">,</span> <span class="n">arcname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;UTF-8&#39;</span><span class="p">):</span>
</span><span id="FernetStore-384"><a href="#FernetStore-384"><span class="linenos">384</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Write a list of lines to arcname&quot;&quot;&quot;</span>
</span><span id="FernetStore-385"><a href="#FernetStore-385"><span class="linenos">385</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_can_write</span><span class="p">()</span>
</span><span id="FernetStore-386"><a href="#FernetStore-386"><span class="linenos">386</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="p">(</span><span class="n">arcname</span><span class="o">=</span><span class="n">arcname</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;wt&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span> <span class="k">as</span> <span class="n">nf</span><span class="p">:</span>
</span><span id="FernetStore-387"><a href="#FernetStore-387"><span class="linenos">387</span></a>            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
</span><span id="FernetStore-388"><a href="#FernetStore-388"><span class="linenos">388</span></a>                <span class="n">nf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="FernetStore-389"><a href="#FernetStore-389"><span class="linenos">389</span></a>
</span><span id="FernetStore-390"><a href="#FernetStore-390"><span class="linenos">390</span></a>    <span class="nd">@property</span>
</span><span id="FernetStore-391"><a href="#FernetStore-391"><span class="linenos">391</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">mtime</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="FernetStore-392"><a href="#FernetStore-392"><span class="linenos">392</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Last modification time read from stream, or None.&quot;&quot;&quot;</span>
</span><span id="FernetStore-393"><a href="#FernetStore-393"><span class="linenos">393</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="FernetStore-394"><a href="#FernetStore-394"><span class="linenos">394</span></a>            <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
</span><span id="FernetStore-395"><a href="#FernetStore-395"><span class="linenos">395</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="FernetStore-396"><a href="#FernetStore-396"><span class="linenos">396</span></a>
</span><span id="FernetStore-397"><a href="#FernetStore-397"><span class="linenos">397</span></a>    <span class="nd">@property</span>
</span><span id="FernetStore-398"><a href="#FernetStore-398"><span class="linenos">398</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">modified</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="FernetStore-399"><a href="#FernetStore-399"><span class="linenos">399</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Archive has been updated but not flushed.&quot;&quot;&quot;</span>
</span><span id="FernetStore-400"><a href="#FernetStore-400"><span class="linenos">400</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_not_closed</span><span class="p">()</span>
</span><span id="FernetStore-401"><a href="#FernetStore-401"><span class="linenos">401</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dirctime</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dirmtime</span>
</span><span id="FernetStore-402"><a href="#FernetStore-402"><span class="linenos">402</span></a>
</span><span id="FernetStore-403"><a href="#FernetStore-403"><span class="linenos">403</span></a>    <span class="nd">@property</span>
</span><span id="FernetStore-404"><a href="#FernetStore-404"><span class="linenos">404</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">closed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="FernetStore-405"><a href="#FernetStore-405"><span class="linenos">405</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;True if this file is closed.&quot;&quot;&quot;</span>
</span><span id="FernetStore-406"><a href="#FernetStore-406"><span class="linenos">406</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dirpath</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="FernetStore-407"><a href="#FernetStore-407"><span class="linenos">407</span></a>
</span><span id="FernetStore-408"><a href="#FernetStore-408"><span class="linenos">408</span></a>    <span class="nd">@property</span>
</span><span id="FernetStore-409"><a href="#FernetStore-409"><span class="linenos">409</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">readable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="FernetStore-410"><a href="#FernetStore-410"><span class="linenos">410</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return whether the file was opened for reading.&quot;&quot;&quot;</span>
</span><span id="FernetStore-411"><a href="#FernetStore-411"><span class="linenos">411</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_not_closed</span><span class="p">()</span>
</span><span id="FernetStore-412"><a href="#FernetStore-412"><span class="linenos">412</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">READ</span>
</span><span id="FernetStore-413"><a href="#FernetStore-413"><span class="linenos">413</span></a>
</span><span id="FernetStore-414"><a href="#FernetStore-414"><span class="linenos">414</span></a>    <span class="nd">@property</span>
</span><span id="FernetStore-415"><a href="#FernetStore-415"><span class="linenos">415</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">writable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="FernetStore-416"><a href="#FernetStore-416"><span class="linenos">416</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return whether the file was opened for writing.&quot;&quot;&quot;</span>
</span><span id="FernetStore-417"><a href="#FernetStore-417"><span class="linenos">417</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_not_closed</span><span class="p">()</span>
</span><span id="FernetStore-418"><a href="#FernetStore-418"><span class="linenos">418</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">WRITE</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">APPEND</span> \
</span><span id="FernetStore-419"><a href="#FernetStore-419"><span class="linenos">419</span></a>            <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">EXCLUSIVE</span>
</span></pre></div>


    

                            <div id="FernetStore.__init__" class="classattr">
                                        <input id="FernetStore.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">FernetStore</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">filename</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">mode</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">fernet_key</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">fileobj</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">secure_open</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">secure_params</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">auto_flush</span><span class="o">=</span><span class="kc">True</span>,</span><span class="param">	<span class="n">backup</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="o">**</span><span class="n">kwargs</span></span>)</span>

                <label class="view-source-button" for="FernetStore.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FernetStore.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FernetStore.__init__-102"><a href="#FernetStore.__init__-102"><span class="linenos">102</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fernet_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fileobj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="FernetStore.__init__-103"><a href="#FernetStore.__init__-103"><span class="linenos">103</span></a>            <span class="n">secure_open</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">secure_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">auto_flush</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="FernetStore.__init__-104"><a href="#FernetStore.__init__-104"><span class="linenos">104</span></a>            <span class="n">backup</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="FernetStore.__init__-105"><a href="#FernetStore.__init__-105"><span class="linenos">105</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Constructor for the FernetFile class.</span>
</span><span id="FernetStore.__init__-106"><a href="#FernetStore.__init__-106"><span class="linenos">106</span></a>
</span><span id="FernetStore.__init__-107"><a href="#FernetStore.__init__-107"><span class="linenos">107</span></a><span class="sd">        At least one of fileobj and filename must be given a</span>
</span><span id="FernetStore.__init__-108"><a href="#FernetStore.__init__-108"><span class="linenos">108</span></a><span class="sd">        non-trivial value.</span>
</span><span id="FernetStore.__init__-109"><a href="#FernetStore.__init__-109"><span class="linenos">109</span></a>
</span><span id="FernetStore.__init__-110"><a href="#FernetStore.__init__-110"><span class="linenos">110</span></a><span class="sd">        The new class instance is based on fileobj, which can be a regular</span>
</span><span id="FernetStore.__init__-111"><a href="#FernetStore.__init__-111"><span class="linenos">111</span></a><span class="sd">        file, an io.BytesIO object, or any other object which simulates a file.</span>
</span><span id="FernetStore.__init__-112"><a href="#FernetStore.__init__-112"><span class="linenos">112</span></a><span class="sd">        It defaults to None, in which case filename is opened to provide</span>
</span><span id="FernetStore.__init__-113"><a href="#FernetStore.__init__-113"><span class="linenos">113</span></a><span class="sd">        a file object.</span>
</span><span id="FernetStore.__init__-114"><a href="#FernetStore.__init__-114"><span class="linenos">114</span></a>
</span><span id="FernetStore.__init__-115"><a href="#FernetStore.__init__-115"><span class="linenos">115</span></a><span class="sd">        When fileobj is not None, the filename argument is only used to be</span>
</span><span id="FernetStore.__init__-116"><a href="#FernetStore.__init__-116"><span class="linenos">116</span></a><span class="sd">        included in the gzip file header, which may include the original</span>
</span><span id="FernetStore.__init__-117"><a href="#FernetStore.__init__-117"><span class="linenos">117</span></a><span class="sd">        filename of the uncompressed file.  It defaults to the filename of</span>
</span><span id="FernetStore.__init__-118"><a href="#FernetStore.__init__-118"><span class="linenos">118</span></a><span class="sd">        fileobj, if discernible; otherwise, it defaults to the empty string,</span>
</span><span id="FernetStore.__init__-119"><a href="#FernetStore.__init__-119"><span class="linenos">119</span></a><span class="sd">        and in this case the original filename is not included in the header.</span>
</span><span id="FernetStore.__init__-120"><a href="#FernetStore.__init__-120"><span class="linenos">120</span></a>
</span><span id="FernetStore.__init__-121"><a href="#FernetStore.__init__-121"><span class="linenos">121</span></a><span class="sd">        The mode argument can be any of &#39;r&#39;, &#39;rb&#39;, &#39;a&#39;, &#39;ab&#39;, &#39;w&#39;, &#39;wb&#39;, &#39;x&#39;, or</span>
</span><span id="FernetStore.__init__-122"><a href="#FernetStore.__init__-122"><span class="linenos">122</span></a><span class="sd">        &#39;xb&#39; depending on whether the file will be read or written.  The default</span>
</span><span id="FernetStore.__init__-123"><a href="#FernetStore.__init__-123"><span class="linenos">123</span></a><span class="sd">        is the mode of fileobj if discernible; otherwise, the default is &#39;rb&#39;.</span>
</span><span id="FernetStore.__init__-124"><a href="#FernetStore.__init__-124"><span class="linenos">124</span></a><span class="sd">        A mode of &#39;r&#39; is equivalent to one of &#39;rb&#39;, and similarly for &#39;w&#39; and</span>
</span><span id="FernetStore.__init__-125"><a href="#FernetStore.__init__-125"><span class="linenos">125</span></a><span class="sd">        &#39;wb&#39;, &#39;a&#39; and &#39;ab&#39;, and &#39;x&#39; and &#39;xb&#39;.</span>
</span><span id="FernetStore.__init__-126"><a href="#FernetStore.__init__-126"><span class="linenos">126</span></a>
</span><span id="FernetStore.__init__-127"><a href="#FernetStore.__init__-127"><span class="linenos">127</span></a><span class="sd">        The fernet_key argument is the Fernet key used to crypt/decrypt data.</span>
</span><span id="FernetStore.__init__-128"><a href="#FernetStore.__init__-128"><span class="linenos">128</span></a><span class="sd">        Encryption is done by chunks to reduce memory footprint. The default</span>
</span><span id="FernetStore.__init__-129"><a href="#FernetStore.__init__-129"><span class="linenos">129</span></a><span class="sd">        chunk_size is 64KB.</span>
</span><span id="FernetStore.__init__-130"><a href="#FernetStore.__init__-130"><span class="linenos">130</span></a>
</span><span id="FernetStore.__init__-131"><a href="#FernetStore.__init__-131"><span class="linenos">131</span></a><span class="sd">        Files are stored in clear mode when opening archive (in a directory in /tmp).</span>
</span><span id="FernetStore.__init__-132"><a href="#FernetStore.__init__-132"><span class="linenos">132</span></a><span class="sd">        You can give a &quot;secured open&quot; command to avoid that (in dev)</span>
</span><span id="FernetStore.__init__-133"><a href="#FernetStore.__init__-133"><span class="linenos">133</span></a>
</span><span id="FernetStore.__init__-134"><a href="#FernetStore.__init__-134"><span class="linenos">134</span></a><span class="sd">        Everytime data are written in archive, it is flushed to file : this means</span>
</span><span id="FernetStore.__init__-135"><a href="#FernetStore.__init__-135"><span class="linenos">135</span></a><span class="sd">        that thar archive is compressed and crypted. You can change this with auto_flush.</span>
</span><span id="FernetStore.__init__-136"><a href="#FernetStore.__init__-136"><span class="linenos">136</span></a><span class="sd">        Data will be flushed only on close.</span>
</span><span id="FernetStore.__init__-137"><a href="#FernetStore.__init__-137"><span class="linenos">137</span></a>
</span><span id="FernetStore.__init__-138"><a href="#FernetStore.__init__-138"><span class="linenos">138</span></a><span class="sd">        This store is thread safe, this allows you to flush from a timer for example.</span>
</span><span id="FernetStore.__init__-139"><a href="#FernetStore.__init__-139"><span class="linenos">139</span></a>
</span><span id="FernetStore.__init__-140"><a href="#FernetStore.__init__-140"><span class="linenos">140</span></a><span class="sd">        If you want to backup archive before flushing it, pass extention to this parameter.</span>
</span><span id="FernetStore.__init__-141"><a href="#FernetStore.__init__-141"><span class="linenos">141</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="FernetStore.__init__-142"><a href="#FernetStore.__init__-142"><span class="linenos">142</span></a>        <span class="k">if</span> <span class="n">fernet_key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="FernetStore.__init__-143"><a href="#FernetStore.__init__-143"><span class="linenos">143</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid fernet key: </span><span class="si">{!r}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fernet_key</span><span class="p">))</span>
</span><span id="FernetStore.__init__-144"><a href="#FernetStore.__init__-144"><span class="linenos">144</span></a>        <span class="k">if</span> <span class="n">mode</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;t&#39;</span> <span class="ow">in</span> <span class="n">mode</span> <span class="ow">or</span> <span class="s1">&#39;U&#39;</span> <span class="ow">in</span> <span class="n">mode</span><span class="p">):</span>
</span><span id="FernetStore.__init__-145"><a href="#FernetStore.__init__-145"><span class="linenos">145</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid mode: </span><span class="si">{!r}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mode</span><span class="p">))</span>
</span><span id="FernetStore.__init__-146"><a href="#FernetStore.__init__-146"><span class="linenos">146</span></a>        <span class="k">if</span> <span class="n">mode</span> <span class="ow">and</span> <span class="s1">&#39;b&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">mode</span><span class="p">:</span>
</span><span id="FernetStore.__init__-147"><a href="#FernetStore.__init__-147"><span class="linenos">147</span></a>            <span class="n">mode</span> <span class="o">+=</span> <span class="s1">&#39;b&#39;</span>
</span><span id="FernetStore.__init__-148"><a href="#FernetStore.__init__-148"><span class="linenos">148</span></a>        <span class="k">if</span> <span class="n">mode</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">):</span>
</span><span id="FernetStore.__init__-149"><a href="#FernetStore.__init__-149"><span class="linenos">149</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">READ</span>
</span><span id="FernetStore.__init__-150"><a href="#FernetStore.__init__-150"><span class="linenos">150</span></a>        <span class="k">elif</span> <span class="n">mode</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">):</span>
</span><span id="FernetStore.__init__-151"><a href="#FernetStore.__init__-151"><span class="linenos">151</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">WRITE</span>
</span><span id="FernetStore.__init__-152"><a href="#FernetStore.__init__-152"><span class="linenos">152</span></a>        <span class="k">elif</span> <span class="n">mode</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">):</span>
</span><span id="FernetStore.__init__-153"><a href="#FernetStore.__init__-153"><span class="linenos">153</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">APPEND</span>
</span><span id="FernetStore.__init__-154"><a href="#FernetStore.__init__-154"><span class="linenos">154</span></a>        <span class="k">elif</span> <span class="n">mode</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">):</span>
</span><span id="FernetStore.__init__-155"><a href="#FernetStore.__init__-155"><span class="linenos">155</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">EXCLUSIVE</span>
</span><span id="FernetStore.__init__-156"><a href="#FernetStore.__init__-156"><span class="linenos">156</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="FernetStore.__init__-157"><a href="#FernetStore.__init__-157"><span class="linenos">157</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid mode: </span><span class="si">{!r}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mode</span><span class="p">))</span>
</span><span id="FernetStore.__init__-158"><a href="#FernetStore.__init__-158"><span class="linenos">158</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
</span><span id="FernetStore.__init__-159"><a href="#FernetStore.__init__-159"><span class="linenos">159</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fernet_key</span> <span class="o">=</span> <span class="n">fernet_key</span>
</span><span id="FernetStore.__init__-160"><a href="#FernetStore.__init__-160"><span class="linenos">160</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>
</span><span id="FernetStore.__init__-161"><a href="#FernetStore.__init__-161"><span class="linenos">161</span></a>        <span class="k">if</span> <span class="n">fileobj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="FernetStore.__init__-162"><a href="#FernetStore.__init__-162"><span class="linenos">162</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">fileobj</span><span class="o">.</span><span class="n">name</span>
</span><span id="FernetStore.__init__-163"><a href="#FernetStore.__init__-163"><span class="linenos">163</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">fileobj</span> <span class="o">=</span> <span class="n">fileobj</span>
</span><span id="FernetStore.__init__-164"><a href="#FernetStore.__init__-164"><span class="linenos">164</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="FernetStore.__init__-165"><a href="#FernetStore.__init__-165"><span class="linenos">165</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
</span><span id="FernetStore.__init__-166"><a href="#FernetStore.__init__-166"><span class="linenos">166</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">fileobj</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="FernetStore.__init__-167"><a href="#FernetStore.__init__-167"><span class="linenos">167</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="FernetStore.__init__-168"><a href="#FernetStore.__init__-168"><span class="linenos">168</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid filename: </span><span class="si">{!r}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
</span><span id="FernetStore.__init__-169"><a href="#FernetStore.__init__-169"><span class="linenos">169</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">backup</span> <span class="o">=</span> <span class="n">backup</span>
</span><span id="FernetStore.__init__-170"><a href="#FernetStore.__init__-170"><span class="linenos">170</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">auto_flush</span> <span class="o">=</span> <span class="n">auto_flush</span>
</span><span id="FernetStore.__init__-171"><a href="#FernetStore.__init__-171"><span class="linenos">171</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_lockfile</span> <span class="o">=</span> <span class="n">FileLock</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">+</span><span class="s1">&#39;.lock&#39;</span><span class="p">)</span>
</span><span id="FernetStore.__init__-172"><a href="#FernetStore.__init__-172"><span class="linenos">172</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">secure_open</span> <span class="o">=</span> <span class="n">_open</span>
</span><span id="FernetStore.__init__-173"><a href="#FernetStore.__init__-173"><span class="linenos">173</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">secure_params</span> <span class="o">=</span> <span class="n">secure_params</span>
</span><span id="FernetStore.__init__-174"><a href="#FernetStore.__init__-174"><span class="linenos">174</span></a>        <span class="k">if</span> <span class="n">secure_open</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="FernetStore.__init__-175"><a href="#FernetStore.__init__-175"><span class="linenos">175</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">secure_open</span> <span class="o">=</span> <span class="n">secure_open</span>
</span><span id="FernetStore.__init__-176"><a href="#FernetStore.__init__-176"><span class="linenos">176</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">secure_params</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="FernetStore.__init__-177"><a href="#FernetStore.__init__-177"><span class="linenos">177</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">secure_params</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="FernetStore.__init__-178"><a href="#FernetStore.__init__-178"><span class="linenos">178</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dirpath</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="FernetStore.__init__-179"><a href="#FernetStore.__init__-179"><span class="linenos">179</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirctime</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="FernetStore.__init__-180"><a href="#FernetStore.__init__-180"><span class="linenos">180</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirmtime</span> <span class="o">=</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Constructor for the FernetFile class.</p>

<p>At least one of fileobj and filename must be given a
non-trivial value.</p>

<p>The new class instance is based on fileobj, which can be a regular
file, an io.BytesIO object, or any other object which simulates a file.
It defaults to None, in which case filename is opened to provide
a file object.</p>

<p>When fileobj is not None, the filename argument is only used to be
included in the gzip file header, which may include the original
filename of the uncompressed file.  It defaults to the filename of
fileobj, if discernible; otherwise, it defaults to the empty string,
and in this case the original filename is not included in the header.</p>

<p>The mode argument can be any of 'r', 'rb', 'a', 'ab', 'w', 'wb', 'x', or
'xb' depending on whether the file will be read or written.  The default
is the mode of fileobj if discernible; otherwise, the default is 'rb'.
A mode of 'r' is equivalent to one of 'rb', and similarly for 'w' and
'wb', 'a' and 'ab', and 'x' and 'xb'.</p>

<p>The fernet_key argument is the Fernet key used to crypt/decrypt data.
Encryption is done by chunks to reduce memory footprint. The default
chunk_size is 64KB.</p>

<p>Files are stored in clear mode when opening archive (in a directory in /tmp).
You can give a "secured open" command to avoid that (in dev)</p>

<p>Everytime data are written in archive, it is flushed to file : this means
that thar archive is compressed and crypted. You can change this with auto_flush.
Data will be flushed only on close.</p>

<p>This store is thread safe, this allows you to flush from a timer for example.</p>

<p>If you want to backup archive before flushing it, pass extention to this parameter.</p>
</div>


                            </div>
                            <div id="FernetStore.filename" class="classattr">
                                <div class="attr variable">
            <span class="name">filename</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#FernetStore.filename"></a>
    
    

                            </div>
                            <div id="FernetStore.fernet_key" class="classattr">
                                <div class="attr variable">
            <span class="name">fernet_key</span>

        
    </div>
    <a class="headerlink" href="#FernetStore.fernet_key"></a>
    
    

                            </div>
                            <div id="FernetStore.kwargs" class="classattr">
                                <div class="attr variable">
            <span class="name">kwargs</span>

        
    </div>
    <a class="headerlink" href="#FernetStore.kwargs"></a>
    
    

                            </div>
                            <div id="FernetStore.backup" class="classattr">
                                <div class="attr variable">
            <span class="name">backup</span>

        
    </div>
    <a class="headerlink" href="#FernetStore.backup"></a>
    
    

                            </div>
                            <div id="FernetStore.auto_flush" class="classattr">
                                <div class="attr variable">
            <span class="name">auto_flush</span>

        
    </div>
    <a class="headerlink" href="#FernetStore.auto_flush"></a>
    
    

                            </div>
                            <div id="FernetStore.secure_open" class="classattr">
                                <div class="attr variable">
            <span class="name">secure_open</span>

        
    </div>
    <a class="headerlink" href="#FernetStore.secure_open"></a>
    
    

                            </div>
                            <div id="FernetStore.secure_params" class="classattr">
                                <div class="attr variable">
            <span class="name">secure_params</span>

        
    </div>
    <a class="headerlink" href="#FernetStore.secure_params"></a>
    
    

                            </div>
                            <div id="FernetStore.dirpath" class="classattr">
                                <div class="attr variable">
            <span class="name">dirpath</span>

        
    </div>
    <a class="headerlink" href="#FernetStore.dirpath"></a>
    
    

                            </div>
                            <div id="FernetStore.open" class="classattr">
                                        <input id="FernetStore.open-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">open</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="FernetStore.open-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FernetStore.open"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FernetStore.open-214"><a href="#FernetStore.open-214"><span class="linenos">214</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="FernetStore.open-215"><a href="#FernetStore.open-215"><span class="linenos">215</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Open the store with a lock&quot;&quot;&quot;</span>
</span><span id="FernetStore.open-216"><a href="#FernetStore.open-216"><span class="linenos">216</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_lockfile</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
</span><span id="FernetStore.open-217"><a href="#FernetStore.open-217"><span class="linenos">217</span></a>        <span class="n">file_exists</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
</span><span id="FernetStore.open-218"><a href="#FernetStore.open-218"><span class="linenos">218</span></a>        <span class="k">if</span> <span class="n">file_exists</span><span class="p">:</span>
</span><span id="FernetStore.open-219"><a href="#FernetStore.open-219"><span class="linenos">219</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">EXCLUSIVE</span><span class="p">:</span>
</span><span id="FernetStore.open-220"><a href="#FernetStore.open-220"><span class="linenos">220</span></a>                <span class="k">raise</span> <span class="ne">FileExistsError</span><span class="p">(</span><span class="s1">&#39;File already exists </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
</span><span id="FernetStore.open-221"><a href="#FernetStore.open-221"><span class="linenos">221</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="FernetStore.open-222"><a href="#FernetStore.open-222"><span class="linenos">222</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">READ</span><span class="p">:</span>
</span><span id="FernetStore.open-223"><a href="#FernetStore.open-223"><span class="linenos">223</span></a>                <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s1">&#39;File not found </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
</span><span id="FernetStore.open-224"><a href="#FernetStore.open-224"><span class="linenos">224</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dirpath</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;.fernet_&quot;</span><span class="p">)</span>
</span><span id="FernetStore.open-225"><a href="#FernetStore.open-225"><span class="linenos">225</span></a>        <span class="k">if</span> <span class="n">file_exists</span><span class="p">:</span>
</span><span id="FernetStore.open-226"><a href="#FernetStore.open-226"><span class="linenos">226</span></a>            <span class="k">with</span> <span class="n">TarZstdFernetFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;rb&#39;</span><span class="p">,</span> <span class="n">fileobj</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fileobj</span><span class="p">,</span> <span class="n">fernet_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fernet_key</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">as</span> <span class="n">tff</span><span class="p">:</span>
</span><span id="FernetStore.open-227"><a href="#FernetStore.open-227"><span class="linenos">227</span></a>                <span class="n">tff</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dirpath</span><span class="p">)</span>
</span><span id="FernetStore.open-228"><a href="#FernetStore.open-228"><span class="linenos">228</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirctime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dirmtime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time_ns</span><span class="p">()</span>
</span><span id="FernetStore.open-229"><a href="#FernetStore.open-229"><span class="linenos">229</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span></pre></div>


            <div class="docstring"><p>Open the store with a lock</p>
</div>


                            </div>
                            <div id="FernetStore.getmembers" class="classattr">
                                        <input id="FernetStore.getmembers-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">getmembers</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="FernetStore.getmembers-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FernetStore.getmembers"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FernetStore.getmembers-246"><a href="#FernetStore.getmembers-246"><span class="linenos">246</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">getmembers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="FernetStore.getmembers-247"><a href="#FernetStore.getmembers-247"><span class="linenos">247</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get members or the store&quot;&quot;&quot;</span>
</span><span id="FernetStore.getmembers-248"><a href="#FernetStore.getmembers-248"><span class="linenos">248</span></a>        <span class="n">members</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="FernetStore.getmembers-249"><a href="#FernetStore.getmembers-249"><span class="linenos">249</span></a>        <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dirpath</span><span class="p">):</span>
</span><span id="FernetStore.getmembers-250"><a href="#FernetStore.getmembers-250"><span class="linenos">250</span></a>            <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
</span><span id="FernetStore.getmembers-251"><a href="#FernetStore.getmembers-251"><span class="linenos">251</span></a>                <span class="n">aname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="n">root</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dirpath</span><span class="p">):],</span> <span class="n">fname</span> <span class="p">)</span>
</span><span id="FernetStore.getmembers-252"><a href="#FernetStore.getmembers-252"><span class="linenos">252</span></a>                <span class="n">members</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">StoreInfo</span><span class="p">(</span><span class="n">aname</span><span class="p">,</span> <span class="n">store_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dirpath</span><span class="p">))</span>
</span><span id="FernetStore.getmembers-253"><a href="#FernetStore.getmembers-253"><span class="linenos">253</span></a>        <span class="k">return</span> <span class="n">members</span>
</span></pre></div>


            <div class="docstring"><p>Get members or the store</p>
</div>


                            </div>
                            <div id="FernetStore.close" class="classattr">
                                        <input id="FernetStore.close-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">close</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="FernetStore.close-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FernetStore.close"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FernetStore.close-255"><a href="#FernetStore.close-255"><span class="linenos">255</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="FernetStore.close-256"><a href="#FernetStore.close-256"><span class="linenos">256</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Close the store. If file is open for writing, the store is rewriting&quot;&quot;&quot;</span>
</span><span id="FernetStore.close-257"><a href="#FernetStore.close-257"><span class="linenos">257</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">writable</span><span class="p">:</span>
</span><span id="FernetStore.close-258"><a href="#FernetStore.close-258"><span class="linenos">258</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_write_store</span><span class="p">()</span>
</span><span id="FernetStore.close-259"><a href="#FernetStore.close-259"><span class="linenos">259</span></a>        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dirpath</span><span class="p">)</span>
</span><span id="FernetStore.close-260"><a href="#FernetStore.close-260"><span class="linenos">260</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dirpath</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="FernetStore.close-261"><a href="#FernetStore.close-261"><span class="linenos">261</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirctime</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="FernetStore.close-262"><a href="#FernetStore.close-262"><span class="linenos">262</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirmtime</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="FernetStore.close-263"><a href="#FernetStore.close-263"><span class="linenos">263</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_lockfile</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Close the store. If file is open for writing, the store is rewriting</p>
</div>


                            </div>
                            <div id="FernetStore.flush" class="classattr">
                                        <input id="FernetStore.flush-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">flush</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">force</span><span class="o">=</span><span class="kc">True</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="FernetStore.flush-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FernetStore.flush"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FernetStore.flush-265"><a href="#FernetStore.flush-265"><span class="linenos">265</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">flush</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="FernetStore.flush-266"><a href="#FernetStore.flush-266"><span class="linenos">266</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Flush data to store if needed. Unless force is True &quot;&quot;&quot;</span>
</span><span id="FernetStore.flush-267"><a href="#FernetStore.flush-267"><span class="linenos">267</span></a>        <span class="k">if</span> <span class="n">force</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">modified</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
</span><span id="FernetStore.flush-268"><a href="#FernetStore.flush-268"><span class="linenos">268</span></a>            <span class="k">return</span>
</span><span id="FernetStore.flush-269"><a href="#FernetStore.flush-269"><span class="linenos">269</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_write_store</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Flush data to store if needed. Unless force is True</p>
</div>


                            </div>
                            <div id="FernetStore.file" class="classattr">
                                        <input id="FernetStore.file-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-contextmanager">@contextmanager</div>

        <span class="def">def</span>
        <span class="name">file</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">arcname</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;rb&#39;</span>, </span><span class="param"><span class="n">encoding</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="FernetStore.file-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FernetStore.file"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FernetStore.file-271"><a href="#FernetStore.file-271"><span class="linenos">271</span></a>    <span class="nd">@contextmanager</span>
</span><span id="FernetStore.file-272"><a href="#FernetStore.file-272"><span class="linenos">272</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arcname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;rb&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="FernetStore.file-273"><a href="#FernetStore.file-273"><span class="linenos">273</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a file descriptor on arcname&quot;&quot;&quot;</span>
</span><span id="FernetStore.file-274"><a href="#FernetStore.file-274"><span class="linenos">274</span></a>        <span class="n">fffile</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="FernetStore.file-275"><a href="#FernetStore.file-275"><span class="linenos">275</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
</span><span id="FernetStore.file-276"><a href="#FernetStore.file-276"><span class="linenos">276</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arcname</span><span class="p">,</span> <span class="n">StoreInfo</span><span class="p">):</span>
</span><span id="FernetStore.file-277"><a href="#FernetStore.file-277"><span class="linenos">277</span></a>                <span class="n">finfo</span> <span class="o">=</span> <span class="n">arcname</span>
</span><span id="FernetStore.file-278"><a href="#FernetStore.file-278"><span class="linenos">278</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="FernetStore.file-279"><a href="#FernetStore.file-279"><span class="linenos">279</span></a>                <span class="n">finfo</span> <span class="o">=</span> <span class="n">StoreInfo</span><span class="p">(</span><span class="n">arcname</span><span class="p">,</span> <span class="n">store_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dirpath</span><span class="p">)</span>
</span><span id="FernetStore.file-280"><a href="#FernetStore.file-280"><span class="linenos">280</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="FernetStore.file-281"><a href="#FernetStore.file-281"><span class="linenos">281</span></a>                <span class="k">if</span> <span class="n">finfo</span><span class="o">.</span><span class="n">subdir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="FernetStore.file-282"><a href="#FernetStore.file-282"><span class="linenos">282</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dirpath</span><span class="p">,</span> <span class="n">finfo</span><span class="o">.</span><span class="n">subdir</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="FernetStore.file-283"><a href="#FernetStore.file-283"><span class="linenos">283</span></a>                <span class="n">fffile</span> <span class="o">=</span> <span class="n">ffile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">secure_open</span><span class="p">(</span><span class="n">finfo</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">secure_params</span><span class="p">)</span>
</span><span id="FernetStore.file-284"><a href="#FernetStore.file-284"><span class="linenos">284</span></a>                <span class="k">yield</span> <span class="n">ffile</span>
</span><span id="FernetStore.file-285"><a href="#FernetStore.file-285"><span class="linenos">285</span></a>                <span class="n">ffile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="FernetStore.file-286"><a href="#FernetStore.file-286"><span class="linenos">286</span></a>                <span class="n">ffile</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="FernetStore.file-287"><a href="#FernetStore.file-287"><span class="linenos">287</span></a>                <span class="k">if</span> <span class="n">mode</span><span class="o">.</span><span class="n">startswith</span><span class="p">((</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">)):</span>
</span><span id="FernetStore.file-288"><a href="#FernetStore.file-288"><span class="linenos">288</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_dirmtime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time_ns</span><span class="p">()</span>
</span><span id="FernetStore.file-289"><a href="#FernetStore.file-289"><span class="linenos">289</span></a>            <span class="k">finally</span><span class="p">:</span>
</span><span id="FernetStore.file-290"><a href="#FernetStore.file-290"><span class="linenos">290</span></a>                <span class="k">if</span> <span class="n">fffile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="FernetStore.file-291"><a href="#FernetStore.file-291"><span class="linenos">291</span></a>                    <span class="n">fffile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="FernetStore.file-292"><a href="#FernetStore.file-292"><span class="linenos">292</span></a>                    <span class="n">fffile</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="FernetStore.file-293"><a href="#FernetStore.file-293"><span class="linenos">293</span></a>
</span><span id="FernetStore.file-294"><a href="#FernetStore.file-294"><span class="linenos">294</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_flush</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">mode</span><span class="o">.</span><span class="n">startswith</span><span class="p">((</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">)):</span>
</span><span id="FernetStore.file-295"><a href="#FernetStore.file-295"><span class="linenos">295</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Return a file descriptor on arcname</p>
</div>


                            </div>
                            <div id="FernetStore.add" class="classattr">
                                        <input id="FernetStore.add-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">filename</span>, </span><span class="param"><span class="n">arcname</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">replace</span><span class="o">=</span><span class="kc">True</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="FernetStore.add-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FernetStore.add"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FernetStore.add-297"><a href="#FernetStore.add-297"><span class="linenos">297</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">arcname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="FernetStore.add-298"><a href="#FernetStore.add-298"><span class="linenos">298</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Add file as arcname. If arcname exists, it is replaced by default.</span>
</span><span id="FernetStore.add-299"><a href="#FernetStore.add-299"><span class="linenos">299</span></a><span class="sd">        Otherwise an exception is raised&quot;&quot;&quot;</span>
</span><span id="FernetStore.add-300"><a href="#FernetStore.add-300"><span class="linenos">300</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
</span><span id="FernetStore.add-301"><a href="#FernetStore.add-301"><span class="linenos">301</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_check_can_write</span><span class="p">()</span>
</span><span id="FernetStore.add-302"><a href="#FernetStore.add-302"><span class="linenos">302</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arcname</span><span class="p">,</span> <span class="n">StoreInfo</span><span class="p">):</span>
</span><span id="FernetStore.add-303"><a href="#FernetStore.add-303"><span class="linenos">303</span></a>                <span class="n">finfo</span> <span class="o">=</span> <span class="n">arcname</span>
</span><span id="FernetStore.add-304"><a href="#FernetStore.add-304"><span class="linenos">304</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="FernetStore.add-305"><a href="#FernetStore.add-305"><span class="linenos">305</span></a>                <span class="n">finfo</span> <span class="o">=</span> <span class="n">StoreInfo</span><span class="p">(</span><span class="n">arcname</span><span class="p">,</span> <span class="n">store_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dirpath</span><span class="p">)</span>
</span><span id="FernetStore.add-306"><a href="#FernetStore.add-306"><span class="linenos">306</span></a>
</span><span id="FernetStore.add-307"><a href="#FernetStore.add-307"><span class="linenos">307</span></a>            <span class="n">file_exists</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">finfo</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</span><span id="FernetStore.add-308"><a href="#FernetStore.add-308"><span class="linenos">308</span></a>            <span class="k">if</span> <span class="n">file_exists</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">replace</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
</span><span id="FernetStore.add-309"><a href="#FernetStore.add-309"><span class="linenos">309</span></a>                <span class="k">raise</span> <span class="ne">FileExistsError</span><span class="p">(</span><span class="s1">&#39;File already exists </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
</span><span id="FernetStore.add-310"><a href="#FernetStore.add-310"><span class="linenos">310</span></a>
</span><span id="FernetStore.add-311"><a href="#FernetStore.add-311"><span class="linenos">311</span></a>            <span class="k">if</span> <span class="n">file_exists</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="FernetStore.add-312"><a href="#FernetStore.add-312"><span class="linenos">312</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_delete</span><span class="p">(</span><span class="n">arcinfo</span><span class="o">=</span><span class="n">finfo</span><span class="p">)</span>
</span><span id="FernetStore.add-313"><a href="#FernetStore.add-313"><span class="linenos">313</span></a>
</span><span id="FernetStore.add-314"><a href="#FernetStore.add-314"><span class="linenos">314</span></a>            <span class="k">if</span> <span class="n">finfo</span><span class="o">.</span><span class="n">subdir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="FernetStore.add-315"><a href="#FernetStore.add-315"><span class="linenos">315</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dirpath</span><span class="p">,</span> <span class="n">finfo</span><span class="o">.</span><span class="n">subdir</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="FernetStore.add-316"><a href="#FernetStore.add-316"><span class="linenos">316</span></a>
</span><span id="FernetStore.add-317"><a href="#FernetStore.add-317"><span class="linenos">317</span></a>            <span class="k">with</span> <span class="n">_open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ff</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">secure_open</span><span class="p">(</span><span class="n">finfo</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;wb&#39;</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">secure_params</span><span class="p">)</span> <span class="k">as</span> <span class="n">sf</span><span class="p">:</span>
</span><span id="FernetStore.add-318"><a href="#FernetStore.add-318"><span class="linenos">318</span></a>                <span class="n">sf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ff</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</span><span id="FernetStore.add-319"><a href="#FernetStore.add-319"><span class="linenos">319</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_dirmtime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time_ns</span><span class="p">()</span>
</span><span id="FernetStore.add-320"><a href="#FernetStore.add-320"><span class="linenos">320</span></a>
</span><span id="FernetStore.add-321"><a href="#FernetStore.add-321"><span class="linenos">321</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_flush</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="FernetStore.add-322"><a href="#FernetStore.add-322"><span class="linenos">322</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Add file as arcname. If arcname exists, it is replaced by default.
Otherwise an exception is raised</p>
</div>


                            </div>
                            <div id="FernetStore.extractall" class="classattr">
                                        <input id="FernetStore.extractall-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">extractall</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">path</span><span class="o">=</span><span class="s1">&#39;.&#39;</span>, </span><span class="param"><span class="n">members</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="FernetStore.extractall-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FernetStore.extractall"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FernetStore.extractall-324"><a href="#FernetStore.extractall-324"><span class="linenos">324</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">extractall</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">members</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="FernetStore.extractall-325"><a href="#FernetStore.extractall-325"><span class="linenos">325</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract all files to path&quot;&quot;&quot;</span>
</span><span id="FernetStore.extractall-326"><a href="#FernetStore.extractall-326"><span class="linenos">326</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
</span><span id="FernetStore.extractall-327"><a href="#FernetStore.extractall-327"><span class="linenos">327</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_check_can_read</span><span class="p">()</span>
</span><span id="FernetStore.extractall-328"><a href="#FernetStore.extractall-328"><span class="linenos">328</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="FernetStore.extractall-329"><a href="#FernetStore.extractall-329"><span class="linenos">329</span></a>            <span class="k">if</span> <span class="n">members</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="FernetStore.extractall-330"><a href="#FernetStore.extractall-330"><span class="linenos">330</span></a>                <span class="n">members</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getmembers</span><span class="p">()</span>
</span><span id="FernetStore.extractall-331"><a href="#FernetStore.extractall-331"><span class="linenos">331</span></a>            <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="n">members</span><span class="p">:</span>
</span><span id="FernetStore.extractall-332"><a href="#FernetStore.extractall-332"><span class="linenos">332</span></a>                <span class="k">if</span> <span class="n">member</span><span class="o">.</span><span class="n">subdir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="FernetStore.extractall-333"><a href="#FernetStore.extractall-333"><span class="linenos">333</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">member</span><span class="o">.</span><span class="n">subdir</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="FernetStore.extractall-334"><a href="#FernetStore.extractall-334"><span class="linenos">334</span></a>
</span><span id="FernetStore.extractall-335"><a href="#FernetStore.extractall-335"><span class="linenos">335</span></a>                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">secure_open</span><span class="p">(</span><span class="n">member</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;rb&#39;</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">secure_params</span><span class="p">)</span> <span class="k">as</span> <span class="n">fin</span><span class="p">,</span> \
</span><span id="FernetStore.extractall-336"><a href="#FernetStore.extractall-336"><span class="linenos">336</span></a>                    <span class="n">_open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">member</span><span class="o">.</span><span class="n">name</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fout</span><span class="p">:</span>
</span><span id="FernetStore.extractall-337"><a href="#FernetStore.extractall-337"><span class="linenos">337</span></a>                        <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">fin</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</span></pre></div>


            <div class="docstring"><p>Extract all files to path</p>
</div>


                            </div>
                            <div id="FernetStore.delete" class="classattr">
                                        <input id="FernetStore.delete-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">delete</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">arcname</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="FernetStore.delete-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FernetStore.delete"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FernetStore.delete-345"><a href="#FernetStore.delete-345"><span class="linenos">345</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arcname</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="FernetStore.delete-346"><a href="#FernetStore.delete-346"><span class="linenos">346</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete file in store&quot;&quot;&quot;</span>
</span><span id="FernetStore.delete-347"><a href="#FernetStore.delete-347"><span class="linenos">347</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
</span><span id="FernetStore.delete-348"><a href="#FernetStore.delete-348"><span class="linenos">348</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arcname</span><span class="p">,</span> <span class="n">StoreInfo</span><span class="p">):</span>
</span><span id="FernetStore.delete-349"><a href="#FernetStore.delete-349"><span class="linenos">349</span></a>                <span class="n">finfo</span> <span class="o">=</span> <span class="n">arcname</span>
</span><span id="FernetStore.delete-350"><a href="#FernetStore.delete-350"><span class="linenos">350</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="FernetStore.delete-351"><a href="#FernetStore.delete-351"><span class="linenos">351</span></a>                <span class="n">finfo</span> <span class="o">=</span> <span class="n">StoreInfo</span><span class="p">(</span><span class="n">arcname</span><span class="p">,</span> <span class="n">store_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dirpath</span><span class="p">)</span>
</span><span id="FernetStore.delete-352"><a href="#FernetStore.delete-352"><span class="linenos">352</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_delete</span><span class="p">(</span><span class="n">arcinfo</span><span class="o">=</span><span class="n">finfo</span><span class="p">)</span>
</span><span id="FernetStore.delete-353"><a href="#FernetStore.delete-353"><span class="linenos">353</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_flush</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="FernetStore.delete-354"><a href="#FernetStore.delete-354"><span class="linenos">354</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Delete file in store</p>
</div>


                            </div>
                            <div id="FernetStore.append" class="classattr">
                                        <input id="FernetStore.append-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">append</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">data</span>, </span><span class="param"><span class="n">arcname</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="FernetStore.append-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FernetStore.append"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FernetStore.append-356"><a href="#FernetStore.append-356"><span class="linenos">356</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">arcname</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="FernetStore.append-357"><a href="#FernetStore.append-357"><span class="linenos">357</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Append data to arcname&quot;&quot;&quot;</span>
</span><span id="FernetStore.append-358"><a href="#FernetStore.append-358"><span class="linenos">358</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_can_write</span><span class="p">()</span>
</span><span id="FernetStore.append-359"><a href="#FernetStore.append-359"><span class="linenos">359</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="p">(</span><span class="n">arcname</span><span class="o">=</span><span class="n">arcname</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;ab&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">nf</span><span class="p">:</span>
</span><span id="FernetStore.append-360"><a href="#FernetStore.append-360"><span class="linenos">360</span></a>            <span class="n">nf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Append data to arcname</p>
</div>


                            </div>
                            <div id="FernetStore.write" class="classattr">
                                        <input id="FernetStore.write-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">write</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">data</span>, </span><span class="param"><span class="n">arcname</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="FernetStore.write-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FernetStore.write"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FernetStore.write-362"><a href="#FernetStore.write-362"><span class="linenos">362</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">arcname</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="FernetStore.write-363"><a href="#FernetStore.write-363"><span class="linenos">363</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Write data to arcname&quot;&quot;&quot;</span>
</span><span id="FernetStore.write-364"><a href="#FernetStore.write-364"><span class="linenos">364</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_can_write</span><span class="p">()</span>
</span><span id="FernetStore.write-365"><a href="#FernetStore.write-365"><span class="linenos">365</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="p">(</span><span class="n">arcname</span><span class="o">=</span><span class="n">arcname</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">nf</span><span class="p">:</span>
</span><span id="FernetStore.write-366"><a href="#FernetStore.write-366"><span class="linenos">366</span></a>            <span class="n">nf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Write data to arcname</p>
</div>


                            </div>
                            <div id="FernetStore.read" class="classattr">
                                        <input id="FernetStore.read-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">read</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">arcname</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="FernetStore.read-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FernetStore.read"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FernetStore.read-368"><a href="#FernetStore.read-368"><span class="linenos">368</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arcname</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="FernetStore.read-369"><a href="#FernetStore.read-369"><span class="linenos">369</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Read data from arcname&quot;&quot;&quot;</span>
</span><span id="FernetStore.read-370"><a href="#FernetStore.read-370"><span class="linenos">370</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_not_closed</span><span class="p">()</span>
</span><span id="FernetStore.read-371"><a href="#FernetStore.read-371"><span class="linenos">371</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="p">(</span><span class="n">arcname</span><span class="o">=</span><span class="n">arcname</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">nf</span><span class="p">:</span>
</span><span id="FernetStore.read-372"><a href="#FernetStore.read-372"><span class="linenos">372</span></a>            <span class="k">return</span> <span class="n">nf</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Read data from arcname</p>
</div>


                            </div>
                            <div id="FernetStore.readlines" class="classattr">
                                        <input id="FernetStore.readlines-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">readlines</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">arcname</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;UTF-8&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="FernetStore.readlines-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FernetStore.readlines"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FernetStore.readlines-374"><a href="#FernetStore.readlines-374"><span class="linenos">374</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">readlines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arcname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;UTF-8&#39;</span><span class="p">):</span>
</span><span id="FernetStore.readlines-375"><a href="#FernetStore.readlines-375"><span class="linenos">375</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Read a list of lines from arcname&quot;&quot;&quot;</span>
</span><span id="FernetStore.readlines-376"><a href="#FernetStore.readlines-376"><span class="linenos">376</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_not_closed</span><span class="p">()</span>
</span><span id="FernetStore.readlines-377"><a href="#FernetStore.readlines-377"><span class="linenos">377</span></a>        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="FernetStore.readlines-378"><a href="#FernetStore.readlines-378"><span class="linenos">378</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="p">(</span><span class="n">arcname</span><span class="o">=</span><span class="n">arcname</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;rt&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span> <span class="k">as</span> <span class="n">nf</span><span class="p">:</span>
</span><span id="FernetStore.readlines-379"><a href="#FernetStore.readlines-379"><span class="linenos">379</span></a>            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">nf</span><span class="p">:</span>
</span><span id="FernetStore.readlines-380"><a href="#FernetStore.readlines-380"><span class="linenos">380</span></a>                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">())</span>
</span><span id="FernetStore.readlines-381"><a href="#FernetStore.readlines-381"><span class="linenos">381</span></a>        <span class="k">return</span> <span class="n">lines</span>
</span></pre></div>


            <div class="docstring"><p>Read a list of lines from arcname</p>
</div>


                            </div>
                            <div id="FernetStore.writelines" class="classattr">
                                        <input id="FernetStore.writelines-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">writelines</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">lines</span>, </span><span class="param"><span class="n">arcname</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;UTF-8&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="FernetStore.writelines-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FernetStore.writelines"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FernetStore.writelines-383"><a href="#FernetStore.writelines-383"><span class="linenos">383</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">writelines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lines</span><span class="p">,</span> <span class="n">arcname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;UTF-8&#39;</span><span class="p">):</span>
</span><span id="FernetStore.writelines-384"><a href="#FernetStore.writelines-384"><span class="linenos">384</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Write a list of lines to arcname&quot;&quot;&quot;</span>
</span><span id="FernetStore.writelines-385"><a href="#FernetStore.writelines-385"><span class="linenos">385</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_can_write</span><span class="p">()</span>
</span><span id="FernetStore.writelines-386"><a href="#FernetStore.writelines-386"><span class="linenos">386</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="p">(</span><span class="n">arcname</span><span class="o">=</span><span class="n">arcname</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;wt&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span> <span class="k">as</span> <span class="n">nf</span><span class="p">:</span>
</span><span id="FernetStore.writelines-387"><a href="#FernetStore.writelines-387"><span class="linenos">387</span></a>            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
</span><span id="FernetStore.writelines-388"><a href="#FernetStore.writelines-388"><span class="linenos">388</span></a>                <span class="n">nf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Write a list of lines to arcname</p>
</div>


                            </div>
                            <div id="FernetStore.mtime" class="classattr">
                                        <input id="FernetStore.mtime-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">mtime</span>

                <label class="view-source-button" for="FernetStore.mtime-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FernetStore.mtime"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FernetStore.mtime-390"><a href="#FernetStore.mtime-390"><span class="linenos">390</span></a>    <span class="nd">@property</span>
</span><span id="FernetStore.mtime-391"><a href="#FernetStore.mtime-391"><span class="linenos">391</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">mtime</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="FernetStore.mtime-392"><a href="#FernetStore.mtime-392"><span class="linenos">392</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Last modification time read from stream, or None.&quot;&quot;&quot;</span>
</span><span id="FernetStore.mtime-393"><a href="#FernetStore.mtime-393"><span class="linenos">393</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="FernetStore.mtime-394"><a href="#FernetStore.mtime-394"><span class="linenos">394</span></a>            <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
</span><span id="FernetStore.mtime-395"><a href="#FernetStore.mtime-395"><span class="linenos">395</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Last modification time read from stream, or None.</p>
</div>


                            </div>
                            <div id="FernetStore.modified" class="classattr">
                                        <input id="FernetStore.modified-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">modified</span>

                <label class="view-source-button" for="FernetStore.modified-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FernetStore.modified"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FernetStore.modified-397"><a href="#FernetStore.modified-397"><span class="linenos">397</span></a>    <span class="nd">@property</span>
</span><span id="FernetStore.modified-398"><a href="#FernetStore.modified-398"><span class="linenos">398</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">modified</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="FernetStore.modified-399"><a href="#FernetStore.modified-399"><span class="linenos">399</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Archive has been updated but not flushed.&quot;&quot;&quot;</span>
</span><span id="FernetStore.modified-400"><a href="#FernetStore.modified-400"><span class="linenos">400</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_not_closed</span><span class="p">()</span>
</span><span id="FernetStore.modified-401"><a href="#FernetStore.modified-401"><span class="linenos">401</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dirctime</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dirmtime</span>
</span></pre></div>


            <div class="docstring"><p>Archive has been updated but not flushed.</p>
</div>


                            </div>
                            <div id="FernetStore.closed" class="classattr">
                                        <input id="FernetStore.closed-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">closed</span>

                <label class="view-source-button" for="FernetStore.closed-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FernetStore.closed"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FernetStore.closed-403"><a href="#FernetStore.closed-403"><span class="linenos">403</span></a>    <span class="nd">@property</span>
</span><span id="FernetStore.closed-404"><a href="#FernetStore.closed-404"><span class="linenos">404</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">closed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="FernetStore.closed-405"><a href="#FernetStore.closed-405"><span class="linenos">405</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;True if this file is closed.&quot;&quot;&quot;</span>
</span><span id="FernetStore.closed-406"><a href="#FernetStore.closed-406"><span class="linenos">406</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dirpath</span> <span class="ow">is</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>True if this file is closed.</p>
</div>


                            </div>
                            <div id="FernetStore.readable" class="classattr">
                                        <input id="FernetStore.readable-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">readable</span>

                <label class="view-source-button" for="FernetStore.readable-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FernetStore.readable"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FernetStore.readable-408"><a href="#FernetStore.readable-408"><span class="linenos">408</span></a>    <span class="nd">@property</span>
</span><span id="FernetStore.readable-409"><a href="#FernetStore.readable-409"><span class="linenos">409</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">readable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="FernetStore.readable-410"><a href="#FernetStore.readable-410"><span class="linenos">410</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return whether the file was opened for reading.&quot;&quot;&quot;</span>
</span><span id="FernetStore.readable-411"><a href="#FernetStore.readable-411"><span class="linenos">411</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_not_closed</span><span class="p">()</span>
</span><span id="FernetStore.readable-412"><a href="#FernetStore.readable-412"><span class="linenos">412</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">READ</span>
</span></pre></div>


            <div class="docstring"><p>Return whether the file was opened for reading.</p>
</div>


                            </div>
                            <div id="FernetStore.writable" class="classattr">
                                        <input id="FernetStore.writable-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">writable</span>

                <label class="view-source-button" for="FernetStore.writable-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FernetStore.writable"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FernetStore.writable-414"><a href="#FernetStore.writable-414"><span class="linenos">414</span></a>    <span class="nd">@property</span>
</span><span id="FernetStore.writable-415"><a href="#FernetStore.writable-415"><span class="linenos">415</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">writable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="FernetStore.writable-416"><a href="#FernetStore.writable-416"><span class="linenos">416</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return whether the file was opened for writing.&quot;&quot;&quot;</span>
</span><span id="FernetStore.writable-417"><a href="#FernetStore.writable-417"><span class="linenos">417</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_not_closed</span><span class="p">()</span>
</span><span id="FernetStore.writable-418"><a href="#FernetStore.writable-418"><span class="linenos">418</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">WRITE</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">APPEND</span> \
</span><span id="FernetStore.writable-419"><a href="#FernetStore.writable-419"><span class="linenos">419</span></a>            <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">EXCLUSIVE</span>
</span></pre></div>


            <div class="docstring"><p>Return whether the file was opened for writing.</p>
</div>


                            </div>
                </section>
                <section id="open">
                            <input id="open-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">open</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">filename</span>, </span><span class="param"><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;rb&#39;</span>, </span><span class="param"><span class="n">fernet_key</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="open-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#open"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="open-422"><a href="#open-422"><span class="linenos">422</span></a><span class="k">def</span><span class="w"> </span><span class="nf">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;rb&quot;</span><span class="p">,</span> <span class="n">fernet_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="open-423"><a href="#open-423"><span class="linenos">423</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Open a FernetStore file in binary mode.</span>
</span><span id="open-424"><a href="#open-424"><span class="linenos">424</span></a>
</span><span id="open-425"><a href="#open-425"><span class="linenos">425</span></a><span class="sd">    The filename argument can be an actual filename (a str or bytes object), or</span>
</span><span id="open-426"><a href="#open-426"><span class="linenos">426</span></a><span class="sd">    an existing file object to read from or write to.</span>
</span><span id="open-427"><a href="#open-427"><span class="linenos">427</span></a>
</span><span id="open-428"><a href="#open-428"><span class="linenos">428</span></a><span class="sd">    The mode argument can be &quot;r&quot;, &quot;rb&quot;, &quot;w&quot;, &quot;wb&quot;, &quot;x&quot;, &quot;xb&quot;, &quot;a&quot; or &quot;ab&quot; for</span>
</span><span id="open-429"><a href="#open-429"><span class="linenos">429</span></a><span class="sd">    binary mode.</span>
</span><span id="open-430"><a href="#open-430"><span class="linenos">430</span></a>
</span><span id="open-431"><a href="#open-431"><span class="linenos">431</span></a><span class="sd">    For binary mode, this function is equivalent to the FernetFile constructor:</span>
</span><span id="open-432"><a href="#open-432"><span class="linenos">432</span></a><span class="sd">    FernetFile(filename, mode, fernet_key). In this case, the encoding, errors</span>
</span><span id="open-433"><a href="#open-433"><span class="linenos">433</span></a><span class="sd">    and newline arguments must not be provided.</span>
</span><span id="open-434"><a href="#open-434"><span class="linenos">434</span></a>
</span><span id="open-435"><a href="#open-435"><span class="linenos">435</span></a>
</span><span id="open-436"><a href="#open-436"><span class="linenos">436</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="open-437"><a href="#open-437"><span class="linenos">437</span></a>    <span class="k">if</span> <span class="s2">&quot;t&quot;</span> <span class="ow">in</span> <span class="n">mode</span><span class="p">:</span>
</span><span id="open-438"><a href="#open-438"><span class="linenos">438</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid mode: </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mode</span><span class="p">,))</span>
</span><span id="open-439"><a href="#open-439"><span class="linenos">439</span></a>
</span><span id="open-440"><a href="#open-440"><span class="linenos">440</span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">)):</span>
</span><span id="open-441"><a href="#open-441"><span class="linenos">441</span></a>        <span class="n">binary_file</span> <span class="o">=</span> <span class="n">FernetStore</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">fernet_key</span><span class="o">=</span><span class="n">fernet_key</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="open-442"><a href="#open-442"><span class="linenos">442</span></a>    <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;read&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;write&quot;</span><span class="p">):</span>
</span><span id="open-443"><a href="#open-443"><span class="linenos">443</span></a>        <span class="n">binary_file</span> <span class="o">=</span> <span class="n">FernetStore</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">fileobj</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="n">fernet_key</span><span class="o">=</span><span class="n">fernet_key</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="open-444"><a href="#open-444"><span class="linenos">444</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="open-445"><a href="#open-445"><span class="linenos">445</span></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;filename must be a str or bytes object, or a file&quot;</span><span class="p">)</span>
</span><span id="open-446"><a href="#open-446"><span class="linenos">446</span></a>
</span><span id="open-447"><a href="#open-447"><span class="linenos">447</span></a>    <span class="k">return</span> <span class="n">binary_file</span>
</span></pre></div>


            <div class="docstring"><p>Open a FernetStore file in binary mode.</p>

<p>The filename argument can be an actual filename (a str or bytes object), or
an existing file object to read from or write to.</p>

<p>The mode argument can be "r", "rb", "w", "wb", "x", "xb", "a" or "ab" for
binary mode.</p>

<p>For binary mode, this function is equivalent to the FernetFile constructor:
FernetFile(filename, mode, fernet_key). In this case, the encoding, errors
and newline arguments must not be provided.</p>
</div>


                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>